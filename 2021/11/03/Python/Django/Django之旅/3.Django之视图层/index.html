<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Django之视图层 | JerryWang</title><meta name="keywords" content="Django"><meta name="author" content="JerryWang"><meta name="copyright" content="JerryWang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="django的视图主要有2种，分别是函数视图和类视图 Django的视图层默认定义在views.py文件中，用来处理web请求信息和返回信息的函数：请求对象（HttpRequest）和相应对象（HttpResponse） 官网解释：请求和响应对象 一、请求与相应请求对象（HttpReques）​    当一个页面被请求时，django会创建一个包含本次请求原信息（如http协议请求报文中的请求行"><meta property="og:type" content="article"><meta property="og:title" content="Django之视图层"><meta property="og:url" content="https://jerrrywang.github.io/2021/11/03/Python/Django/Django%E4%B9%8B%E6%97%85/3.Django%E4%B9%8B%E8%A7%86%E5%9B%BE%E5%B1%82/index.html"><meta property="og:site_name" content="JerryWang"><meta property="og:description" content="django的视图主要有2种，分别是函数视图和类视图 Django的视图层默认定义在views.py文件中，用来处理web请求信息和返回信息的函数：请求对象（HttpRequest）和相应对象（HttpResponse） 官网解释：请求和响应对象 一、请求与相应请求对象（HttpReques）​    当一个页面被请求时，django会创建一个包含本次请求原信息（如http协议请求报文中的请求行"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://jerrrywang.github.io/2018/10/11/photo/ming_2.jpg"><meta property="article:published_time" content="2021-11-03T04:38:58.000Z"><meta property="article:modified_time" content="2022-12-02T06:45:33.000Z"><meta property="article:author" content="JerryWang"><meta property="article:tag" content="Django"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://jerrrywang.github.io/2018/10/11/photo/ming_2.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://jerrrywang.github.io/2021/11/03/Python/Django/Django%E4%B9%8B%E6%97%85/3.Django%E4%B9%8B%E8%A7%86%E5%9B%BE%E5%B1%82/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://jerrrywang.github.io/api/shubiao/Cyan.ttf" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"NL6QRV8F8M",apiKey:"0b99ef5723aa77799f47331a0e3bc4ff",indexName:"my-blog",hits:{per_page:6},languages:{input_placeholder:"搜索文章",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,noticeOutdate:{limitDay:30,position:"top",messagePrev:"本文上次更新于",messageNext:"天前，文章内容可能已经过时。"},highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!0},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:50,languages:{author:"作者: JerryWang",link:"链接: ",source:"来源: JerryWang",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css"}},isPhotoFigcaption:!0,islazyload:!1,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Django之视图层",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-12-02 14:45:33"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const a=864e5*o,n={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(n))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const a=document.createElement("script");a.src=e,a.async=!0,a.onerror=o,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=(new Date).getHours();void 0===t?o<=6||o>=18?activateDarkMode():activateLightMode():"light"===t?activateLightMode():activateDarkMode();const a=saveToLocal.get("aside-status");void 0!==a&&("hide"===a?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="/js/welcome.js"></script><script src="/js/sweetalert.js"></script><script src="/api/shubiao/sakuraDrops.js"></script><link rel="stylesheet" href="/css/sweetalert.css"><style>#toggle-sidebar{left:100px}</style><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://jerrrywang.github.io/api/npm/hexo-electric-clock-plus/clock.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">140</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">87</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时光轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-coffee"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-bicycle"></i> <span>相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-heartbeat"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-motorcycle"></i> <span>清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i> <span>电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i> <span>书籍</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://jerrrywang.github.io/2018/10/11/photo/ming_2.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">JerryWang</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时光轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-coffee"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-bicycle"></i> <span>相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-heartbeat"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-motorcycle"></i> <span>清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i> <span>电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i> <span>书籍</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django之视图层</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-03T04:38:58.000Z" title="发表于 2021-11-03 12:38:58">2021-11-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-02T06:45:33.000Z" title="更新于 2022-12-02 14:45:33">2022-12-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django/">Django</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django/Django%E4%B9%8B%E6%97%85/">Django之旅</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>55分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Django之视图层"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><img src="视图层.png" alt="img"></p><p>django的视图主要有2种，分别是<code>函数视图</code>和<code>类视图</code></p><p>Django的视图层默认定义在views.py文件中，用来处理web请求信息和返回信息的函数：请求对象（HttpRequest）和相应对象（HttpResponse）</p><p>官网解释：<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/3.2/ref/request-response/">请求和响应对象</a></p><h1 id="一、请求与相应"><a href="#一、请求与相应" class="headerlink" title="一、请求与相应"></a>一、请求与相应</h1><h2 id="请求对象（HttpReques）"><a href="#请求对象（HttpReques）" class="headerlink" title="请求对象（HttpReques）"></a>请求对象（HttpReques）</h2><p>​ 当一个页面被请求时，django会创建一个包含本次请求原信息（如http协议请求报文中的请求行、首部信息、内容主体）的HttpRequest对象。</p><p>​ 之后，django会找到匹配的视图，将该对象传给视图函数的第一个参数，约定俗称该参数名为request。</p><p>​ 在视图函数中，通过访问该对象的属性便可以提取http协议的请求数据</p><blockquote><p>常用的http请求：</p><p>POST 添加/上传</p><p>GET 获取/下载</p><p>PUT/PATCH 修改，其中PUT表示修改整体数据，PATCH表示修改部分数据</p><p>DELETE 删除</p></blockquote><h3 id="HttpRequest对象常用属性part1"><a href="#HttpRequest对象常用属性part1" class="headerlink" title="HttpRequest对象常用属性part1"></a>HttpRequest对象常用属性part1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">request本质就是WSGIRequest的实例对象，父类是<span class="keyword">from</span> django.http.request <span class="keyword">import</span> HttpRequest</span><br><span class="line">一.HttpRequest.method</span><br><span class="line">　　获取请求使用的方法（值为纯大写的字符串格式）。例如：<span class="string">&quot;GET&quot;</span>、<span class="string">&quot;POST&quot;</span></span><br><span class="line">   应该通过该属性的值来判断请求方法</span><br><span class="line"></span><br><span class="line">   在视图函数中：</span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">       ...</span><br><span class="line">   <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">       ...</span><br><span class="line"></span><br><span class="line">二.HttpRequest.GET</span><br><span class="line">　　值为一个类似于字典的QueryDict对象，封装了GET请求的所有参数，可通过HttpRequest.GET.get(<span class="string">&#x27;键&#x27;</span>)获取相对应的值</span><br><span class="line">    http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/app01/login?name=allen&amp;passwd=<span class="number">123</span></span><br><span class="line">	&lt;QueryDict: &#123;<span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;allen&#x27;</span>], <span class="string">&#x27;passwd&#x27;</span>: [<span class="string">&#x27;123&#x27;</span>]&#125;&gt;</span><br><span class="line">    QueryDict 是一个经过封装的字典，提供了基本的字典操作，还提供额外的操作给开发者获取字典内部的数据，因为python基本数据类型<span class="built_in">dict</span>是无法让字典在一个key下指向多个值的情况，所以Django封装了一个新的字典来实现</span><br><span class="line"></span><br><span class="line">   在视图函数中：</span><br><span class="line">   request.GET.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">三.HttpRequest.POST</span><br><span class="line">   值为一个类似于字典的QueryDict对象，封装了POST请求所包含的表单数据，可通过HttpRequest.POST.get(<span class="string">&#x27;键&#x27;</span>)获取相对应的值</span><br><span class="line"></span><br><span class="line">   在视图函数中：</span><br><span class="line">   request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">   针对表单中checkbox类型的<span class="built_in">input</span>标签、select标签提交的数据，键对应的值为多个，需要用：HttpRequest.POST.getlist(<span class="string">&quot;hobbies&quot;</span>)获取存有多个值的列表,同理也有HttpRequest.GET.getlist(<span class="string">&quot;键&quot;</span>)</span><br><span class="line">   针对有多个值的的情况，也可以用HttpRequest.GET.get(<span class="string">&quot;键&quot;</span>)，会获取列表中的最后一个值</span><br><span class="line">四. 比如</span><br><span class="line">	  request.method	   获取请求动作</span><br><span class="line">    request.path       获取请求地址</span><br><span class="line">    request.path_info  获取请求地址信息</span><br><span class="line">    request.get_port	 获取端口</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>案例：</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">urls.py</button></li><li class="tab"><button type="button" data-href="#test4-2">views.py</button></li><li class="tab"><button type="button" data-href="#test4-3">在templates目录下新建login.html</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">&#x27;login/&#x27;</span>,views.login),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="comment"># 当请求url为：http://127.0.0.1:8000/login/?a=1&amp;b=2&amp;c=3&amp;c=4&amp;c=5</span></span><br><span class="line">        <span class="comment"># 请求方法是GET，?后的请求参数都存放于request.GET中</span></span><br><span class="line">        <span class="built_in">print</span>(request.GET)</span><br><span class="line">        <span class="comment"># 输出&lt;QueryDict: &#123;&#x27;a&#x27;: [&#x27;1&#x27;], &#x27;b&#x27;: [&#x27;2&#x27;], &#x27;c&#x27;: [&#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;]&#125;&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取？后参数的方式为</span></span><br><span class="line">        a=request.GET.get(<span class="string">&#x27;a&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">        b=request.GET.get(<span class="string">&#x27;b&#x27;</span>) <span class="comment"># 2</span></span><br><span class="line">        c=request.GET.getlist(<span class="string">&#x27;c&#x27;</span>) <span class="comment"># [&#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;]</span></span><br><span class="line">        c1=request.GET.get(<span class="string">&#x27;c&#x27;</span>) <span class="comment"># 5</span></span><br><span class="line">        c2=request.GET.<span class="built_in">dict</span>()  <span class="comment"># 转换成字典，会去重&#123;&#x27;a&#x27;: &#x27;1&#x27;, &#x27;b&#x27;: &#x27;2&#x27;, &#x27;c&#x27;: &#x27;5&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 在输入框内输入用户名allen、年龄18，选择爱好，点击提交</span></span><br><span class="line">        <span class="comment"># 请求方法为POST，表单内的数据都会存放于request.POST中</span></span><br><span class="line">        <span class="built_in">print</span>(request.POST) </span><br><span class="line">        <span class="comment"># 输出&lt;QueryDict: &#123;..., &#x27;name&#x27;: [&#x27;allen&#x27;], &#x27;age&#x27;: [&#x27;18&#x27;], &#x27;hobbies&#x27;: [&#x27;music&#x27;, &#x27;read&#x27;]&#125;&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取表单中数据的方式为</span></span><br><span class="line">        name=request.POST.get(<span class="string">&#x27;name&#x27;</span>) <span class="comment"># allen</span></span><br><span class="line">        age=request.POST.get(<span class="string">&#x27;age&#x27;</span>) <span class="comment"># 18</span></span><br><span class="line">        hobbies=request.POST.getlist(<span class="string">&#x27;hobbies&#x27;</span>) <span class="comment"># [&#x27;music&#x27;, &#x27;read&#x27;]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;提交成功&#x27;</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">method=&quot;post&quot;代表在提交表单时会以POST方法提交表单数据</span></span><br><span class="line"><span class="comment">action=&quot;/login/&quot; 代表表单数据的提交地址为http://127.0.0.1:8000/login/,可以简写为action=&quot;/login/&quot;,或者action=&quot;&quot;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:8000/login/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125; <span class="comment">&lt;!--强调：必须加上这一行，后续我们会详细介绍--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        爱好：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span> <span class="attr">value</span>=<span class="string">&quot;music&quot;</span>&gt;</span>音乐</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span> <span class="attr">value</span>=<span class="string">&quot;read&quot;</span>&gt;</span>阅读</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dancing&quot;</span>&gt;</span>跳舞</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="HttpRequest对象常用属性part2"><a href="#HttpRequest对象常用属性part2" class="headerlink" title="HttpRequest对象常用属性part2"></a>HttpRequest对象常用属性part2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">一.HttpRequest.body</span><br><span class="line">  <span class="number">1.1</span> 当浏览器基于http协议的GET方法提交数据时(没有请求体一说),数据会按照k1=v1&amp;k2=v2&amp;k3=v3的格式放到url中，然后发送给django，django会将这些数据封装到request.GET中，注意此时的请求体request.body为空、无用</span><br><span class="line"></span><br><span class="line">  <span class="number">1.2</span> 当浏览器基于http协议的POST方法提交数据时，数据会被放到请求体中发送给django，django会将接收到的请求体数据存放于HttpRequest.body属性中.</span><br><span class="line">  但该属性的值为Bytes类型(套接字数据传输都是<span class="built_in">bytes</span>类型)，而通常情况下直接处理Bytes、并从中提取有用数据的操作是复杂而繁琐的，好在django会对它做进一步的处理与封装以便我们更为方便地提取数据，具体如何处理呢？</span><br><span class="line"></span><br><span class="line">  当前端采用POST提交数据时，数据有三种常用编码格式，编码格式不同Django会有不同的处理方式</span><br><span class="line">  <span class="comment"># 编码格式1：application/x-www-form-urlencoded，是form表单默认编码格式</span></span><br><span class="line">  <span class="comment"># 编码格式2：multipart/form-data，上传文件专用格式</span></span><br><span class="line">  <span class="comment"># 编码格式2：application/json，提交json格式字符串</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#====》I: 当POST数据的编码格式为application/x-www-form-urlencoded时《====</span></span><br><span class="line">      HttpRequest.body中的数据格式为<span class="string">b&#x27;a=1&amp;b=2&amp;c=3&#x27;</span></span><br><span class="line">      django会将其提取出来封装到request.POST中</span><br><span class="line">      request.FILES此时为空</span><br><span class="line"></span><br><span class="line">      如：</span><br><span class="line">      <span class="built_in">print</span>(request.body) <span class="comment"># b&#x27;a=1&amp;b=2&amp;c=3&#x27;</span></span><br><span class="line">      <span class="built_in">print</span>(request.POST) <span class="comment"># &lt;QueryDict: &#123;&#x27;a&#x27;: [&#x27;1&#x27;],&#x27;b&#x27;: [&#x27;2&#x27;],&#x27;c&#x27;: [&#x27;3&#x27;]&#125;</span></span><br><span class="line">      <span class="built_in">print</span>(request.FILES) <span class="comment"># &lt;MultiValueDict: &#123;&#125;&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">#====》II: 当POST数据的编码格式为multipart/form-data时《====</span></span><br><span class="line">      详见：https://my.oschina.net/cnlw/blog/<span class="number">168466</span>?fromerr=aQL9sTI2</span><br><span class="line"></span><br><span class="line">      HttpRequest.body中的数据格式为<span class="string">b&#x27;------WebKitFormBoundaryKtcwuksQltpNprep\r\nContent-Disposition: form-data;......&#x27;</span>,注意，文件部分数据是流数据，所以不在浏览器中显示是正常的</span><br><span class="line">      django会将request.body中的非文件数据部分提取出来封装到request.POST中</span><br><span class="line">      将上传的文件部分数据专门提取出来封装到request.FILES属性中</span><br><span class="line"></span><br><span class="line">      如：</span><br><span class="line">      <span class="built_in">print</span>(request.body) <span class="comment"># 不要打印它，打印则报错，因为它是数据流</span></span><br><span class="line">      <span class="built_in">print</span>(request.POST) <span class="comment"># &lt;QueryDict: &#123;&#x27;a&#x27;: [&#x27;1&#x27;],&#x27;b&#x27;: [&#x27;2&#x27;],&#x27;c&#x27;: [&#x27;3&#x27;]&#125;</span></span><br><span class="line">      <span class="built_in">print</span>(request.FILES) <span class="comment"># &lt;MultiValueDict: &#123;&#x27;head_img&#x27;: [&lt;InMemoryUploadedFile: 11111.jpg (image/jpeg)&gt;]&#125;&gt;</span></span><br><span class="line"></span><br><span class="line">      强调：</span><br><span class="line">        <span class="number">1</span>、毫无疑问，编码格式<span class="number">2</span>的数据量要大于编码格式<span class="number">1</span>，如果无需上传文件，还是推荐使用更为精简的编码格式<span class="number">1</span></span><br><span class="line">        <span class="number">2</span>、FILES will only contain data <span class="keyword">if</span> the request method was POST <span class="keyword">and</span> the &lt;form&gt; that posted to the request had enctype=<span class="string">&quot;multipart/form-data&quot;</span>. Otherwise, FILES will be a blank dictionary-like <span class="built_in">object</span>.</span><br><span class="line"></span><br><span class="line">  <span class="comment">#===》III: 当POST数据的编码格式为application/json时《====</span></span><br><span class="line">      此时在django后台，request.POST和request.FILES中是没有值的，都放到request.body中了，需要用json.loads对其进行反序列化</span><br><span class="line"></span><br><span class="line">      如：</span><br><span class="line">      <span class="built_in">print</span>(request.body) <span class="comment"># b&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3&#125;&#x27;</span></span><br><span class="line">      <span class="built_in">print</span>(request.POST) <span class="comment"># &lt;QueryDict: &#123;&#125;&gt;</span></span><br><span class="line">      <span class="built_in">print</span>(request.FILES) <span class="comment"># &lt;MultiValueDict: &#123;&#125;&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="number">1.3</span> 如何设定POST提交数据的编码格式 </span><br><span class="line">    前端往后台POST提交数据，常用技术有form表单和ajax两种</span><br><span class="line">    form表单可以设置的数据编码格式有：编码格式<span class="number">1</span>、编码格式<span class="number">2</span></span><br><span class="line">    ajax可以设置的数据编码格式有：编码格式<span class="number">1</span>、编码格式<span class="number">2</span>、编码格式<span class="number">3</span></span><br><span class="line"></span><br><span class="line">    我们将在后续章节中介绍ajax技术，此处我们先介绍我们熟知的form表单</span><br><span class="line">    form表单可以通过属性enctype进行设置编码格，如下</span><br><span class="line">      编码格式<span class="number">1</span>(默认的编码格式):enctype=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span> </span><br><span class="line">      编码格式<span class="number">2</span>(使用form表单上传文件时只能用该编码):enctype=<span class="string">&quot;multipart/form-data&quot;</span></span><br></pre></td></tr></table></figure><p>案例：form表单上传文件</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">urls.py</button></li><li class="tab"><button type="button" data-href="#test4-2">views.py</button></li><li class="tab"><button type="button" data-href="#test4-3">在templates目录下新建register.html</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">&#x27;register/&#x27;</span>,views.register),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    保存上传文件前，数据需要存放在某个位置。默认当上传文件小于2.5M时，django会将上传文件的全部内容读进内存。从内存读取一次，写磁盘一次。</span></span><br><span class="line"><span class="string">    但当上传文件很大时，django会把上传文件写到临时文件中，然后存放到系统临时文件夹中。</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># print(request.body) # 读取流数据会抛出异常，请注释掉它</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 从request.POST中获取用户名</span></span><br><span class="line">        name = request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 从request.FILES获取文件对象</span></span><br><span class="line">        file_obj = request.FILES.get(<span class="string">&#x27;header_img&#x27;</span>)</span><br><span class="line">        <span class="comment"># 从文件对象中获取文件名</span></span><br><span class="line">        filename = file_obj.name</span><br><span class="line">        <span class="built_in">print</span>(filename)</span><br><span class="line"></span><br><span class="line">        file_obj.chunks()</span><br><span class="line">        <span class="comment"># 上传的文件存放于templates文件夹下</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&quot;templates/<span class="subst">&#123;file_name&#125;</span>&quot;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> file_obj.chunks():</span><br><span class="line">                f.write(line)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;注册成功&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 强调：</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    file_obj.read() 当文件过大时，会导致内存溢出，系统崩溃</span></span><br><span class="line"><span class="string">    应该使用file_obj.chunks()读取，官网解释如下</span></span><br><span class="line"><span class="string">    uploadedFile.chunks(chunk_size=None)¶</span></span><br><span class="line"><span class="string">    A generator returning chunks of the file. If multiple_chunks() is True, you should use this method in a loop instead of read().</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    In practice, it’s often easiest simply to use chunks() all the time. Looping over chunks() instead of using read() ensures that large files don’t overwhelm your system’s memory.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    注意：直接for循环file_obj也不行，因为直接for读取文件是按照行分隔符来依次读取的，不同平台下的文件行分隔符不同，有可能一行的数据就很大，所以还是推荐file_obj.chunks()来读取，官网解释如下</span></span><br><span class="line"><span class="string">    Like regular Python files, you can read the file line-by-line simply by iterating over the uploaded file:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    for line in uploadedfile:</span></span><br><span class="line"><span class="string">        do_something_with(line)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Lines are split using universal newlines. The following are recognized as ending a line: the Unix end-of-line convention &#x27;\n&#x27;, the Windows convention &#x27;\r\n&#x27;, and the old Macintosh convention &#x27;\r&#x27;.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>注册页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> &gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        头像:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;header_img&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="HttpRequest对象常用属性part3"><a href="#HttpRequest对象常用属性part3" class="headerlink" title="HttpRequest对象常用属性part3"></a>HttpRequest对象常用属性part3</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">一.HttpRequest.path</span><br><span class="line">　　获取url地址的路径部分，只包含路径部分</span><br><span class="line"></span><br><span class="line">二.HttpRequest.get_full_path()</span><br><span class="line">　　获取url地址的完整path，既包含路径又包含参数部分</span><br><span class="line"></span><br><span class="line">如果请求地址是http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/order/?name=allen&amp;age=<span class="number">10</span><span class="comment">#_label3，</span></span><br><span class="line">HttpRequest.path的值为<span class="string">&quot;/order/&quot;</span></span><br><span class="line">HttpRequest.get_full_path()的值为<span class="string">&quot;/order/?name=allen&amp;age=10&quot;</span></span><br></pre></td></tr></table></figure><p>案例：</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">urls.py</button></li><li class="tab"><button type="button" data-href="#test4-2">views.py</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,register_converter,re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^order&#x27;</span>,views.order),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对请求的url地址：http://127.0.0.1:8000/order/?name=allen&amp;age=10#_label3</span></span><br><span class="line"><span class="comment"># 从域名后的最后一个“/”开始到“？”为止是路径部分，即/order/</span></span><br><span class="line"><span class="comment"># 从“？”开始到“#”为止之间的部分为参数部分,即name=allen&amp;age=10</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">order</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="built_in">print</span>(request.path) <span class="comment"># 结果为“/order/”</span></span><br><span class="line">    <span class="built_in">print</span>(request.get_full_path()) <span class="comment"># 结果为&quot;/order/?name=allen&amp;age=10&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;order page OK&#x27;</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="HttpRequest对象常用属性part4（暂作了解）"><a href="#HttpRequest对象常用属性part4（暂作了解）" class="headerlink" title="HttpRequest对象常用属性part4（暂作了解）"></a>HttpRequest对象常用属性part4（暂作了解）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">　　django将请求报文中的请求行、头部信息、内容主体封装成 HttpRequest 类中的属性。</span></span><br><span class="line"><span class="string">   除了特殊说明的之外，其他均为只读的。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">一.HttpRequest.META</span><br><span class="line"> 　 值为包含了HTTP协议的请求头数据的Python字典，字典中的key及期对应值的解释如下</span><br><span class="line">    CONTENT_LENGTH —— 请求的正文的长度（是一个字符串）。</span><br><span class="line">    CONTENT_TYPE —— 请求的正文的MIME类型。</span><br><span class="line">    HTTP_ACCEPT —— 响应可接收的Content-<span class="type">Type</span>。</span><br><span class="line">    HTTP_ACCEPT_ENCODING —— 响应可接收的编码。</span><br><span class="line">    HTTP_ACCEPT_LANGUAGE —— 响应可接收的语言。</span><br><span class="line">    HTTP_HOST —— 客服端发送数据的目标主机与端口</span><br><span class="line">    HTTP_REFERER —— Referring 页面。</span><br><span class="line">    HTTP_USER_AGENT —— 客户端使用的软件版本信息</span><br><span class="line">    QUERY_STRING —— 单个字符串形式的查询字符串（未解析过的形式）。</span><br><span class="line">    REMOTE_ADDR —— 客户端的IP地址。</span><br><span class="line">    REMOTE_HOST —— 客户端的主机名。</span><br><span class="line">    REMOTE_USER —— 服务器认证后的用户。</span><br><span class="line">    REQUEST_METHOD —— 一个字符串，例如<span class="string">&quot;GET&quot;</span> 或<span class="string">&quot;POST&quot;</span>。</span><br><span class="line">    SERVER_NAME —— 服务器的主机名。</span><br><span class="line">    SERVER_PORT —— 服务器的端口（是一个字符串）。</span><br><span class="line"> 　　从上面可以看到，除 CONTENT_LENGTH 和 CONTENT_TYPE 之外，HTTP协议的请求头数据转换为 META 的键时，</span><br><span class="line">    都会</span><br><span class="line">    <span class="number">1</span>、将所有字母大写</span><br><span class="line">    <span class="number">2</span>、将单词的连接符替换为下划线</span><br><span class="line">    <span class="number">3</span>、加上前缀HTTP_。</span><br><span class="line">    所以，一个叫做 X-Bender 的头部将转换成 META 中的 HTTP_X_BENDER 键。</span><br><span class="line"></span><br><span class="line">注意：下述常用属性暂且了解即可，待我们讲到专门的知识点时再专门详细讲解</span><br><span class="line">二.HttpRequest.COOKIES</span><br><span class="line">　　一个标准的Python 字典，包含所有的cookie。键和值都为字符串。</span><br><span class="line"></span><br><span class="line">三.HttpRequest.session</span><br><span class="line"> 　一个既可读又可写的类似于字典的对象，表示当前的会话。只有当Django 启用会话的支持时才可用。</span><br><span class="line"></span><br><span class="line"><span class="number">11.</span>HttpRequest.user(用户认证组件下使用)</span><br><span class="line"></span><br><span class="line">　　一个 AUTH_USER_MODEL 类型的对象，表示当前登录的用户。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>HttpRequest.is_ajax()</span><br><span class="line"></span><br><span class="line">　　如果请求是通过XMLHttpRequest 发起的，则返回<span class="literal">True</span>，方法是检查 HTTP_X_REQUESTED_WITH 相应的首部是否是字符串<span class="string">&#x27;XMLHttpRequest&#x27;</span>。</span><br><span class="line"></span><br><span class="line">　　大部分现代的 JavaScript 库都会发送这个头部。如果你编写自己的 XMLHttpRequest 调用（在浏览器端），你必须手工设置这个值来让 is_ajax() 可以工作。</span><br><span class="line"></span><br><span class="line">　　如果一个响应需要根据请求是否是通过AJAX 发起的，并且你正在使用某种形式的缓存例如Django 的 cache middleware，</span><br><span class="line">   你应该使用 vary_on_headers(<span class="string">&#x27;HTTP_X_REQUESTED_WITH&#x27;</span>) 装饰你的视图以让响应能够正确地缓存。</span><br><span class="line"></span><br><span class="line">四.HttpRequest.encoding</span><br><span class="line">　　一个字符串，表示提交的数据的编码方式（如果为 <span class="literal">None</span> 则表示使用 DEFAULT_CHARSET 的设置，默认为 <span class="string">&#x27;utf-8&#x27;</span>）。</span><br><span class="line">   这个属性是可写的，你可以修改它来修改访问表单数据使用的编码。</span><br><span class="line">   接下来对属性的任何访问（例如从 GET 或 POST 中读取数据）将使用新的 encoding 值。</span><br><span class="line">   如果你知道表单数据的编码不是 DEFAULT_CHARSET ，则使用它。</span><br><span class="line"></span><br><span class="line">五.HttpRequest.scheme</span><br><span class="line">   表示请求方案的字符串（通常为http或https）</span><br><span class="line"></span><br><span class="line">六.HttpRequest.user</span><br><span class="line">　　一个AUTH_USER_MODEL类型的对象，表示当前登录的用户。</span><br><span class="line"></span><br><span class="line">　　如果用户当前没有登录，user将设置为django.contrib.auth.models.AnonymousUser的一个实例。</span><br><span class="line">你可以通过is_authenticated()区分它们，例如：</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.user.is_authenticated():</span><br><span class="line">        <span class="comment"># Do something for logged-in users.</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># Do something for anonymous users.</span></span><br><span class="line"></span><br><span class="line">    HttpRequest.user只有当Django 启用 AuthenticationMiddleware中间件时才可用。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    匿名用户</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">models</span>.AnonymousUser</span><br><span class="line"></span><br><span class="line">    django.contrib.auth.models.AnonymousUser 类实现了django.contrib.auth.models.User 接口，但具有下面几个不同点：</span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span> 永远为<span class="literal">None</span>。</span><br><span class="line">    username 永远为空字符串。</span><br><span class="line">    get_username() 永远返回空字符串。</span><br><span class="line">    is_staff 和 is_superuser 永远为<span class="literal">False</span>。</span><br><span class="line">    is_active 永远为 <span class="literal">False</span>。</span><br><span class="line">    groups 和 user_permissions 永远为空。</span><br><span class="line">    is_anonymous() 返回<span class="literal">True</span> 而不是<span class="literal">False</span>。</span><br><span class="line">    is_authenticated() 返回<span class="literal">False</span> 而不是<span class="literal">True</span>。</span><br><span class="line">    set_password()、check_password()、save() 和delete() 引发 NotImplementedError。</span><br><span class="line">    New <span class="keyword">in</span> Django <span class="number">1.8</span>:</span><br><span class="line">    新增 AnonymousUser.get_username() 以更好地模拟 django.contrib.auth.models.User。</span><br></pre></td></tr></table></figure><h2 id="响应对象"><a href="#响应对象" class="headerlink" title="响应对象"></a>响应对象</h2><p>请求对象HttpRequest是由django为我们创建好的，直接使用即可，而响应对象则需要我们负责创建。我们编写的每个视图都应该返回一个HttpResponse对象，响应可以是一个网页的HTML内容，一个重定向，一个404错误，一个XML文档，或者一张图片。用来返回响应对象的常用类如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> redirect</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http importJsonResponse</span><br></pre></td></tr></table></figure><h3 id="HttpResponse"><a href="#HttpResponse" class="headerlink" title="HttpResponse"></a>HttpResponse</h3><p>传递字符串</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line">response = HttpResponse(<span class="string">&quot;Here&#x27;s the text of the Web page.&quot;</span>)</span><br><span class="line">response = HttpResponse(<span class="string">&quot;Text only, please.&quot;</span>, content_type=<span class="string">&quot;text/plain&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ps：Content-Type用于指定响应体的MIME类型</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MIME类型：</span></span><br><span class="line"><span class="string">mime类型是多用途互联网邮件扩展类型。是设定某种扩展名的文件用一种应用程序来打开的方式类型,当该扩展名文件被访问的时候,浏览器会自动使用指定应用程序来打开</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MIME 类型有非常多种，一般常见的有：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　text/html：浏览器在获取到这种文件时会自动调用html的解析器对文件进行相应的处理。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　text/plain：意思是将文件设置为纯文本的形式，浏览器在获取到这种文件时并不会对其进行处理。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　image/jpeg：JPEG格式的图片</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　image/gif：GIF格式的图片</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　video/quicktime：Apple 的 QuickTime 电影</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">　　application/vnd.ms-powerpoint：微软的powerpoint文件</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>依次增加字符串（了解）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = HttpResponse()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.write(<span class="string">&quot;&lt;p&gt;Here&#x27;s the text of the Web page.&lt;/p&gt;&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.write(<span class="string">&quot;&lt;p&gt;Here&#x27;s another paragraph.&lt;/p&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><p>传递迭代器对象（了解）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以为HttpResponse传递可迭代对象，HttpRespone会将其依次迭代然后存储成字符串，类似文件或者其他带有close()方法的生成器对象，会自动调用close()关闭</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    f=<span class="built_in">open</span>(<span class="string">r&#x27;a.txt&#x27;</span>,mode=<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="comment"># a.txt文件内容为111</span></span><br><span class="line">    response=HttpResponse(f)</span><br><span class="line">    <span class="built_in">print</span>(response.content) <span class="comment"># 打印内容为: b&#x27;111&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># f.read() # 如果执行，则会抛出异常，说明文件已经关闭了，无法读取</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><p>自定义添加或删除响应头信息</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">response = HttpResponse()</span><br><span class="line">response[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;text/html; charset=UTF-8&#x27;</span></span><br><span class="line">response[<span class="string">&#x27;X-Frame-Options&#x27;</span>] = <span class="string">&#x27;SAMEORIGIN&#x27;</span></span><br><span class="line"><span class="keyword">del</span> response[<span class="string">&#x27;Content-Type&#x27;</span>]</span><br></pre></td></tr></table></figure><p>属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HttpResponse.status_code：响应的状态码</span><br><span class="line"></span><br><span class="line">HttpResponse.charset：响应内容的编码encode格式</span><br><span class="line"></span><br><span class="line">HttpResponse.content：响应内容</span><br></pre></td></tr></table></figure><p>返回图片信息</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;相应内容&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    通过django.http.response.HttpResponse响应html内容</span></span><br><span class="line"><span class="string">    return HttpResponse(&quot;&lt;h1&gt;HELLO&lt;/h1&gt;&quot;) </span></span><br><span class="line"><span class="string">    content: 响应正文内容</span></span><br><span class="line"><span class="string">    status： 响应状态码</span></span><br><span class="line"><span class="string">    content-type: 响应内容的MIME类型</span></span><br><span class="line"><span class="string">    ret = HttpResponse(content=&#x27;HELLO&#x27;,status=&#x27;206&#x27;,content_type=&#x27;text/html&#x27;)</span></span><br><span class="line"><span class="string">    return ret</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 返回其他格式内容如：图片信息，文件，资源下载。。。</span></span><br><span class="line">    content=<span class="built_in">open</span>(<span class="string">&#x27;qqq.png&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(content=content,status=<span class="number">206</span>,content_type=<span class="string">&quot;image/png&quot;</span>)</span><br></pre></td></tr></table></figure><p>提供下载支持</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">wget</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\User\Downloads\app.zip&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content=f.read()</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(content=content,content_type=<span class="string">&quot;application/x-zip-compressed&quot;</span>)</span><br></pre></td></tr></table></figure><p>字符串编码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编码设定原则：编码格式与解码格式保持一致</span></span><br><span class="line">response = HttpResponse(charset=<span class="string">&#x27;gbk&#x27;</span>,content_type=<span class="string">&#x27;text/html; charset=gbk&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数charset=&#x27;gbk&#x27;指定响应体内容response.content的编码格式</span></span><br><span class="line"><span class="comment"># 参数content_type=&#x27;text/html; charset=gbk&#x27;是设置响应头，用于告诉浏览器响应体内容response.content应该采用何种解码格式，注意：设置时必须加上内容的类型，如text/html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 强调：</span></span><br><span class="line"><span class="comment"># 如果在实例化HttpResponse时没有指定charset=gbk&#x27;，将会采用与content_type中设定的解码格式一样的编码，这样统一起来就不会出现乱码问题</span></span><br><span class="line"><span class="comment"># 如果也没有指定content_type，那么django默认会读取配置文件中的配置settings.py.DEFAULT_CHARSET来作为默认的编码与解码格式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    response = HttpResponse(charset=<span class="string">&#x27;gbk&#x27;</span>,content_type=<span class="string">&#x27;text/html; charset=gbk&#x27;</span>)</span><br><span class="line">    response.charset=<span class="string">&#x27;gbk&#x27;</span> <span class="comment"># 实例化后，可以对该属性重新赋值，只要是在write内容前，就会以最新赋值的编码格式为准</span></span><br><span class="line"></span><br><span class="line">    response.write(<span class="string">&quot;&lt;p&gt;Hello allen美男子&lt;/p&gt;&quot;</span>)</span><br><span class="line">    response.write(<span class="string">&quot;&lt;p&gt;Hello 林sb&lt;/p&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果实例化处未指定响应头Content-Type，也可以在此处设置，在一处就可以了，无需重复设置</span></span><br><span class="line">    response[<span class="string">&#x27;Content-Type&#x27;</span>]=<span class="string">&#x27;text/html; charset=gbk&#x27;</span>  </span><br><span class="line">    <span class="comment"># response[&#x27;Content-Type&#x27;]=&#x27;text/html; charset=UTF-8&#x27; </span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(response.charset)</span><br><span class="line">    <span class="built_in">print</span>(response.content) </span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">request, template_name, context=<span class="literal">None</span>, content_type=<span class="literal">None</span>, status=<span class="literal">None</span>, using=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Return a HttpResponse whose content is filled with the result of calling</span></span><br><span class="line"><span class="string">    django.template.loader.render_to_string() with the passed arguments.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    content = loader.render_to_string(template_name, context, request, using=using)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(content, content_type, status)</span><br><span class="line"></span><br><span class="line">参数：</span><br><span class="line">    <span class="number">1</span>、request：用于生成响应的请求对象，固定必须传入的第一个参数</span><br><span class="line"></span><br><span class="line">    <span class="number">2</span>、template_name：要使用的模板的完整名称，必须传入，render默认会去templates目录下查找模板文件</span><br><span class="line"></span><br><span class="line">    <span class="number">3</span>、context：可选参数，可以传入一个字典用来替换模块文件中的变量，默认是一个空字典。如果字典中的某个值是可调用的，视图将在渲染模板之前调用它。</span><br><span class="line"></span><br><span class="line">    <span class="number">4</span>、content_type：生成的文档要使用的MIME类型。默认为 DEFAULT_CONTENT_TYPE 设置的值。默认为<span class="string">&#x27;text/html&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="number">5</span>、status：响应的状态码。默认为<span class="number">200</span>。</span><br><span class="line"></span><br><span class="line">    <span class="number">6</span>、useing: 用于加载模板的模板引擎的名称。</span><br></pre></td></tr></table></figure><p>综上，render的功能可以总结为：根据给定字典渲染模板文件，并返回一个渲染后的HttpResponse对象。简单示例如下</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">urls.py</button></li><li class="tab"><button type="button" data-href="#test4-2">views.py</button></li><li class="tab"><button type="button" data-href="#test4-3">templates目录下新增文件index.html</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^$&#x27;</span>,views.index),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index.html&#x27;</span>, &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;allen&#x27;</span>, <span class="string">&#x27;tag&#x27;</span>: <span class="string">&#x27;dsb&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上述代码等同于</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    t = loader.get_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    dic = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;allen&#x27;</span>, <span class="string">&#x27;tag&#x27;</span>: <span class="string">&#x27;dsb&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(t.render(dic, request)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; tag &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>测试</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动django，在浏览器中访问url地址http://ip地址:端口号/，会看到&#123;&#123; name &#125;&#125; &#123;&#123; tag &#125;&#125;被替换成了allen和dsb</span></span><br></pre></td></tr></table></figure><h3 id="redirect"><a href="#redirect" class="headerlink" title="redirect"></a>redirect</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">返回重定向对象，返回的状态码为<span class="number">302</span>，第一个参数用来指定浏览器重定向的地址，可以是</span><br><span class="line"><span class="comment">#1、一个完全标准的URL地址，如&#x27;https://www.yahoo.com/search/&#x27;</span></span><br><span class="line"><span class="comment">#2、也可以是一个没有域名的绝对路径，如&#x27;/search/&#x27;</span></span><br><span class="line"><span class="comment">#3、或者是一个没有域名的相对路径，如&#x27;search/&#x27;,与1、2直接跳转到指定的绝对路径不同，相对路径需要先与当前路径进行拼后才能跳转，例如：如果当前路径为http://127.0.0.1:8080/index/，拼接后的路径为http://127.0.0.1:8080/index/search/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">baidu</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># redirect重定向等同于下述操作</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">baidu</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;浏览器收到Location和302后就自动跳转&#x27;&#x27;&#x27;</span></span><br><span class="line">    response=HttpResponse(<span class="string">&quot;&quot;</span>,status=<span class="number">302</span>)	<span class="comment"># 自定义响应头</span></span><br><span class="line">    <span class="comment"># response[&#x27;Location&#x27;]=&#x27;/register/&#x27;</span></span><br><span class="line">    response[<span class="string">&quot;Location&quot;</span>]=<span class="string">&quot;https:/www.baidu.com&quot;</span>	<span class="comment"># 发送Location响应信息指定跳转地址 </span></span><br><span class="line">    <span class="keyword">return</span> response </span><br></pre></td></tr></table></figure><p>示例如下</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">urls.py</button></li><li class="tab"><button type="button" data-href="#test4-2">views.py</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^baidu/$&#x27;</span>, views.baidu),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse,redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>) <span class="comment"># 跳转到http://127.0.0.1:8000/login/</span></span><br><span class="line">    <span class="comment"># return redirect(&#x27;login/&#x27;) # 跳转到http://127.0.0.1:8000/index/login/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;login page&quot;</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>测试：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">启动django，在浏览器中访问url地址http://ip地址:端口号/index/，跳转到login页面</span><br></pre></td></tr></table></figure><p>重定向转态码301与302的区别（了解）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">一、<span class="number">301</span>和<span class="number">302</span>的异同。</span><br><span class="line">   <span class="number">1</span>、相同之处：</span><br><span class="line">   <span class="number">301</span>和<span class="number">302</span>状态码都表示重定向，具体点说就是浏览器在拿到服务器返回的这个状态码后会自动跳转到一个新的URL地址（浏览器会从响应头Location中获取新地址），用户看到的效果都是输入地址A后瞬间跳转到了另一个地址B</span><br><span class="line"></span><br><span class="line">   <span class="number">2</span>、不同之处：</span><br><span class="line">　　<span class="number">301</span>表示永久重定向，旧地址A的资源已经被永久地移除了，即这个资源不可访问了。</span><br><span class="line">　　<span class="number">302</span>表示临时重定向，旧地址A的资源还在，即这个资源仍然可以访问。</span><br><span class="line"></span><br><span class="line">    A页面临时重定向到B页面，那搜索引擎收录的就是A页面。</span><br><span class="line">    A页面永久重定向到B页面，那搜索引擎收录的就是B页面。</span><br><span class="line">    从SEO层面考虑，<span class="number">302</span>要好于<span class="number">301</span></span><br><span class="line"></span><br><span class="line">二、重定向原因：</span><br><span class="line">   <span class="number">1</span>、网站调整（如改变网页目录结构）；</span><br><span class="line">   <span class="number">2</span>、网页被移到一个新地址；</span><br><span class="line">   <span class="number">3</span>、网页扩展名改变(如应用需要把.php改成.Html或.shtml)。</span><br><span class="line">      这种情况下，如果不做重定向，则用户收藏夹或搜索引擎数据库中旧地址只能让访问客户得到一个<span class="number">404</span>页面错误信息，访问流量白白丧失；再者某些注册了多个域名的网站，也需要通过重定向让访问这些域名的用户自动跳转到主站点等。</span><br></pre></td></tr></table></figure><h3 id="JsonResponse"><a href="#JsonResponse" class="headerlink" title="JsonResponse"></a>JsonResponse</h3><p>JSON就是Javascript Object Notation.最早来源于JavaScript</p><p>json就是一个数据格式，一般保存在文件中，以<code>.json</code>作为文件扩展名</p><ol><li>json数据类型：</li></ol><ul><li>字符串，必须以双引号圈起来</li></ul><ul><li>数组，python里面的列表</li></ul><ul><li>json，python里面的字典格式</li></ul><ul><li>数值，所有的整数，小数，布尔值都是数值</li></ul><ul><li>unidentified # 未定义</li></ul><ul><li>null python里的None</li></ul><ol><li>数组成员，可以是json中任何的数据类型，但是每一个成员之间必须以英文逗号隔开，最后一个成员后面不能带有逗号，否则报错！！！</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="string">&quot;xiaoming&quot;</span><span class="punctuation">,</span><span class="keyword">true</span><span class="punctuation">,</span><span class="keyword">false</span><span class="punctuation">,</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;k&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><ol><li>json成员的键必须是字符串格式,成员之间用逗号隔开，最后一个成员不能带有逗号、</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;xiaoming&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;son&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;xiaoxiaoming&quot;</span><span class="punctuation">,</span></span><br><span class="line">    	<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">3</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol><li>json文件中，一般只能存在一个json数据</li></ol><p>json一般用于不同系统，不同项目之间传递数据用的， 向前端返回一个json格式字符串的两种方式</p><p>方式一：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">import</span> json</span><br><span class="line">    content=&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;xiaoming&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>:<span class="number">30</span>,</span><br><span class="line">            <span class="string">&quot;son&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>:<span class="string">&quot;xiaoxiaoming&quot;</span>,</span><br><span class="line">                <span class="string">&quot;age&quot;</span>:<span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    content=json.dumps(content)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(content=content,status=<span class="number">206</span>,content_type=<span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">  <span class="comment"># return HttpResponse(content=content)</span></span><br></pre></td></tr></table></figure><p>方式二：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line">    content=&#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;xiaoming&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>:<span class="number">30</span>,</span><br><span class="line">            <span class="string">&quot;son&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>:<span class="string">&quot;xiaoxiaoming&quot;</span>,</span><br><span class="line">                <span class="string">&quot;age&quot;</span>:<span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(content)</span><br><span class="line"><span class="comment">### 如果是以列表的方式返回会报错</span></span><br><span class="line"><span class="comment">#	TypeError at /app01/index/</span></span><br><span class="line"><span class="comment">#	In order to allow non-dict objects to be serialized set the safe parameter to False.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line">    content=[</span><br><span class="line">        &#123;<span class="string">&quot;id&quot;</span>:<span class="number">10</span>,<span class="string">&quot;title&quot;</span>:<span class="string">&quot;qqqqq&quot;</span>,<span class="string">&quot;pric&quot;</span>:<span class="number">10</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;id&quot;</span>:<span class="number">11</span>,<span class="string">&quot;title&quot;</span>:<span class="string">&quot;wwwwww&quot;</span>,<span class="string">&quot;pric&quot;</span>:<span class="number">10</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(content,safe=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment">#默认safe=True代表只能序列化字典对象，safe=False代表序列化字典以外的对象</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="二、异常处理"><a href="#二、异常处理" class="headerlink" title="二、异常处理"></a>二、异常处理</h1><h2 id="django内置异常处理视图"><a href="#django内置异常处理视图" class="headerlink" title="django内置异常处理视图"></a>django内置异常处理视图</h2><p>Web应用在线上运行的过程中出现错误，是不可避免的，常见错误如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、<span class="number">400</span>：<span class="number">400</span> Bad Request 是由于明显的客户端错误（例如，格式错误的请求语法，太大的大小，无效的请求消息或欺骗性路由请求），服务器不能或不会处理该请求。</span><br><span class="line"><span class="number">2</span>、<span class="number">403</span>：用户没有访问某一资源的权限</span><br><span class="line"><span class="number">3</span>、<span class="number">404</span>：请求的url地址不存在</span><br><span class="line"><span class="number">4</span>、<span class="number">500</span>：服务端出错</span><br></pre></td></tr></table></figure><p>django框架为其中的一些常见错误提供了标准的错误页面，但它们仅限于DEBUG=True调试模式下使用，要想符合生产环境的需求，则需要我们进行自定制，配置过程如下</p><p>步骤1.在templates目录下的顶层创建错误页面400.html、403.html、404.html、500.html，注意文件内容自定义，但文件名与放置位置不可改变</p><p>templates/400.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>自定义400页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>templates/403.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>自定义403页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;&#123; exception &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>templates/404.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>自定义404页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;&#123; exception &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>templates/500.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>自定义500页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>步骤2.编写处理异常的视图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 针对上述四种错误，django框架内置了处理异常的视图，如下</span></span><br><span class="line"><span class="keyword">from</span> django.views.defaults <span class="keyword">import</span> bad_request <span class="comment"># 用来处理400异常</span></span><br><span class="line"><span class="keyword">from</span> django.views.defaults <span class="keyword">import</span> permission_denied <span class="comment"># 用来处理403异常</span></span><br><span class="line"><span class="keyword">from</span> django.views.defaults <span class="keyword">import</span> page_not_found <span class="comment"># 用来处理404异常</span></span><br><span class="line"><span class="keyword">from</span> django.views.defaults <span class="keyword">import</span> server_error <span class="comment"># 用来处理500异常</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 此处由于篇幅问题，请读者自行查看源码，通过查看源码，可以知道</span></span><br><span class="line"><span class="comment"># 1、内置的异常处理视图会去固定位置找对应的文件名，这就是我们自定制错误页面文件位置与文件名固定的原因</span></span><br><span class="line"><span class="comment"># 2、内置的异常处理视图，针对400和500错误返回的就是静态页面，而针对403和404错误会用异常变量exception来渲染页面，我们在定制403.html、404.html页面时设定一个模板语法&#123;&#123; exception &#125;&#125;就是用来专门接收异常值的</span></span><br></pre></td></tr></table></figure><p>步骤3.请将 settings.py 中的 DEBUG设置为Fasle,这样，如果出现错误，就会出现我们自己定义的页面</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">DEBUG = <span class="literal">False</span> <span class="comment"># 在生产环境中就应该设置成False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ps：设置完DEBUG=False后，必须设置ALLOWED_HOSTS才能启动django，设为ALLOWED_HOSTS = [&#x27;*&#x27;]即可</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>]</span><br></pre></td></tr></table></figure><p>完成上述步骤后，我们来测试一下</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">urls.py</button></li><li class="tab"><button type="button" data-href="#test4-2">views.py</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;test/400&#x27;</span>,views.error_test_400),</span><br><span class="line">    path(<span class="string">&#x27;test/403&#x27;</span>,views.error_test_403),</span><br><span class="line">    path(<span class="string">&#x27;test/404&#x27;</span>,views.error_test_404),</span><br><span class="line">    path(<span class="string">&#x27;test/500&#x27;</span>,views.error_test_500),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> SuspiciousFileOperation</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> PermissionDenied</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> Http404</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们在编写正常视图view时会依据具体的逻辑，主动或被动抛出相对应的异常类型，此处为了测试精简，省略了正常逻辑，直接抛出异常</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_test_400</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">raise</span> SuspiciousFileOperation(<span class="string">&#x27;抛出400异常&#x27;</span>) <span class="comment"># 异常信息不会展现在页面中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_test_403</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">raise</span> PermissionDenied(<span class="string">&#x27;抛出403异常&#x27;</span>) <span class="comment"># 异常信息会展现在页面中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_test_404</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">raise</span> PermissionDenied(<span class="string">&#x27;抛出404异常&#x27;</span>) <span class="comment"># 异常信息会展现在页面中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_test_500</span>(<span class="params">request</span>):</span><br><span class="line">    xxx <span class="comment"># 会抛出异常NameError，异常信息不会展现在页面中</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>测试</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在浏览器依次输入下述url地址，会执行对应的视图函数，触发异常，django内置的异常处理视图会捕捉异常并返回我们定制的错误页面</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span>/test/<span class="number">400</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span>/test/<span class="number">403</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span>/test/<span class="number">404</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span>/test/<span class="number">500</span></span><br></pre></td></tr></table></figure><h2 id="自定义异常处理视图"><a href="#自定义异常处理视图" class="headerlink" title="自定义异常处理视图"></a>自定义异常处理视图</h2><p>django内置的异常处理视图应该可以满足大部分Web应用的需求，但不可否认的是缺乏灵活性，比如我们想在400.html页面中也获取异常信息，此时就需要自定制400异常的处理视图了，为了满足读者日后的需求，我们在此将四个异常处理视图都自定义一下，在上例的基础上，作出如下操作</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">1、修改上例的templates/400.html，其他页面不变</button></li><li class="tab"><button type="button" data-href="#test4-2">2、views.py中新增自定义异常处理视图</button></li><li class="tab"><button type="button" data-href="#test4-3">3、urls.py中，让异常处理指向自定义视图</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>自定义400页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;&#123; exception &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ================》下面是我们正常的应用视图《================</span></span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> SuspiciousFileOperation</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> PermissionDenied</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> Http404</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们在编写正常视图view时会依据具体的逻辑，主动或被动抛出相对应的异常类型，此处为了测试精简，省略了正常逻辑，直接抛出异常</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_test_400</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">raise</span> SuspiciousFileOperation(<span class="string">&#x27;抛出400异常&#x27;</span>) <span class="comment"># 异常信息不会展现在页面中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_test_403</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">raise</span> PermissionDenied(<span class="string">&#x27;抛出403异常&#x27;</span>) <span class="comment"># 异常信息会展现在页面中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_test_404</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">raise</span> PermissionDenied(<span class="string">&#x27;抛出404异常&#x27;</span>) <span class="comment"># 异常信息会展现在页面中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error_test_500</span>(<span class="params">request</span>):</span><br><span class="line">    xxx <span class="comment"># 会抛出异常NameError，异常信息不会展现在页面中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ================》新增自定义异常处理视图《================</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_custom_bad_request_view</span>(<span class="params">request, exception</span>):  <span class="comment"># 400</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    处理400异常的视图，必须接收两个参数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数request:</span></span><br><span class="line"><span class="string">    参数exception: 捕获的异常值</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回值: django规定该函数需要返回一个HttpResponseBadRequest类的对象</span></span><br><span class="line"><span class="string">           可以查看该类的源码，该类是HttpResponse的子类，并设置status_code = 400</span></span><br><span class="line"><span class="string">           from django.views.defaults import HttpResponseBadRequest</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           明白了上述原理，为了方便我们渲染自定义页面，此处我们采用render返回，设置好status_code即可</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;====&gt;400&#x27;</span>)</span><br><span class="line">    response = render(request, <span class="string">&#x27;400.html&#x27;</span>, &#123;<span class="string">&#x27;exception&#x27;</span>: exception&#125;)</span><br><span class="line">    response.status_code = <span class="number">400</span>  <span class="comment"># 如果不设置，默认状态码为200</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_custom_permission_denied_view</span>(<span class="params">request, exception</span>):  <span class="comment"># 403</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    处理403异常的视图，必须接收两个参数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数request:</span></span><br><span class="line"><span class="string">    参数exception: 捕获的异常值</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回值: django规定该函数需要返回一个HttpResponseForbidden类的对象</span></span><br><span class="line"><span class="string">           可以查看该类的源码，该类是HttpResponse的子类，并设置status_code = 403</span></span><br><span class="line"><span class="string">           from django.views.defaults import HttpResponseForbidden</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           明白了上述原理，为了方便我们渲染自定义页面，此处我们采用render返回，设置好status_code即可</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;====&gt;403&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    response = render(request, <span class="string">&#x27;403.html&#x27;</span>, &#123;<span class="string">&#x27;exception&#x27;</span>: exception&#125;)</span><br><span class="line">    response.status_code = <span class="number">403</span>  <span class="comment"># 如果不设置，默认状态码为200</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_custom_page_not_found_view</span>(<span class="params">request, exception</span>):  <span class="comment"># 404</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    处理404异常的视图，必须接收两个参数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数request:</span></span><br><span class="line"><span class="string">    参数exception: 捕获的异常值</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回值: django规定该函数需要返回一个HttpResponseNotFound类的对象</span></span><br><span class="line"><span class="string">           可以查看该类的源码，该类是HttpResponse的子类，并设置status_code = 404</span></span><br><span class="line"><span class="string">           from django.views.defaults import HttpResponseNotFound</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           明白了上述原理，为了方便我们渲染自定义页面，此处我们采用render返回，设置好status_code即可</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;====&gt;404&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    response = render(request, <span class="string">&#x27;404.html&#x27;</span>, &#123;<span class="string">&#x27;exception&#x27;</span>: exception&#125;)</span><br><span class="line">    response.status_code = <span class="number">404</span>  <span class="comment"># 如果不设置，默认状态码为200</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_custom_error_view</span>(<span class="params">request</span>):  <span class="comment"># 500</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    处理500异常的视图，只接收一个参数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回值: django规定该函数需要返回一个HttpResponseServerError类的对象</span></span><br><span class="line"><span class="string">           可以查看该类的源码，该类是HttpResponse的子类，并设置status_code = 500</span></span><br><span class="line"><span class="string">           from django.views.defaults import HttpResponseServerError</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           明白了上述原理，为了方便我们渲染自定义页面，此处我们采用render返回，设置好status_code即可</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;====&gt;500&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    response = render(request, <span class="string">&#x27;500.html&#x27;</span>, )  <span class="comment"># 服务端的错误本就不应该暴露给客户端</span></span><br><span class="line">    response.status_code = <span class="number">500</span>  <span class="comment"># 如果不设置，默认状态码为200</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;test/400&#x27;</span>,views.error_test_400),</span><br><span class="line">    path(<span class="string">&#x27;test/403&#x27;</span>,views.error_test_403),</span><br><span class="line">    path(<span class="string">&#x27;test/404&#x27;</span>,views.error_test_404),</span><br><span class="line">    path(<span class="string">&#x27;test/500&#x27;</span>,views.error_test_500),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增下列四行，下述变量名固定，对应的值为自定义异常处理视图</span></span><br><span class="line">handler400 = <span class="string">&#x27;app01.views.my_custom_bad_request_view&#x27;</span> <span class="comment"># 代表处理400异常指向自定义异常处理视图</span></span><br><span class="line">handler403 = <span class="string">&#x27;app01.views.my_custom_permission_denied_view&#x27;</span></span><br><span class="line"></span><br><span class="line">handler404 = <span class="string">&#x27;app01.views.my_custom_page_not_found_view&#x27;</span></span><br><span class="line">handler500 = <span class="string">&#x27;app01.views.my_custom_error_view&#x27;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1 id="三、FBV与CBV"><a href="#三、FBV与CBV" class="headerlink" title="三、FBV与CBV"></a>三、FBV与CBV</h1><h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>官网地址：<a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/3.0/topics/class-based-views/">https://docs.djangoproject.com/en/3.0/topics/class-based-views/</a></p><p>视图是可调用的，用来处理请求(request)并且返回响应(response)，django的视图有两种形式：FBV和CBV</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、FBV基于函数的视图（Function base views），我们之前一直介绍的都是FBV</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、CBV基于类的视图(Class base views)，我们本节主要介绍它</span><br></pre></td></tr></table></figure><p>在早期，人们意识到视图开发的过程中存在一些常见的语法和模式，于是引入基于函数的通用视图来抽象这些模式，并简化了常见情况下的视图开发。因此，刚开始的时候只有FBV，django所做的事情就是向你定义的视图函数传递一个HttpRequest，并且希望返回一个HttpResponse。</p><p>随着进一步的发展，人们发现，基于函数的通用视图是有问题的，问题在于它很好地覆盖了简单的情况，但针对稍微复杂的场景，它没有办法在某些配置项之外进行扩展或自定义，从而极大地限制了它在许多实际应用程序中的实用性。而考虑到扩展性与自定义，这正是面向对象技术的强大之处，于是诞生了CBV。</p><p>基于类的通用视图与基于函数的通用视图目的都一样，都是为了让视图开发更加容易。但是CBV的解决方案是通过使用mixins，并且django内置了一系列通用视图作为工具集提供给我们继承使用，从而使得基于类的通用视图比基于函数的通用视图更具扩展性和灵活性。</p><p>如果你之前尝试过FBV，但发现它有缺陷，CBV是一种新的解决方案，而不是单纯地换了一种定义视图的形式，如果CBV只是视图的另外一种定义形式而已，那岂不是很无聊，连介绍的必要都没有了。</p><p>为了让读者快速掌握CBV的使用，我们只能从简单情况下举例，这看起来会是增加了代码的复杂度，读者可能会对其嗤之以鼻，其实不然，在读者日后遇到复杂的情况时，唯有CBV可以进行更高级的设计</p><p>综上，CBV并非是FBV的完全替代品，但相对于FBV，CBV确实有一些差异和优势，详解下一小节</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、针对不同的HTTP请求方法(如GET、POST)，CBV可以分别对应到专门的处理方法上，无需采用条件分支，代码更加精简</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、CBV采用面向对象技术，比如mixins（多重继承）可用于将代码转换成可重用的组件。</span><br></pre></td></tr></table></figure><h2 id="使用CBV"><a href="#使用CBV" class="headerlink" title="使用CBV"></a>使用CBV</h2><h2 id="使用不同的实例方法来响应不同的HTTP请求方法"><a href="#使用不同的实例方法来响应不同的HTTP请求方法" class="headerlink" title="使用不同的实例方法来响应不同的HTTP请求方法"></a>使用不同的实例方法来响应不同的HTTP请求方法</h2><p>CBV允许我们使用不同的实例方法来响应不同的HTTP请求方法，而不是像FBV那样使用条件分支代码</p><p>1.1 FBV中视图函数处理HTTP的GET请求如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_view</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="comment"># &lt;view logic&gt;</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;GET result&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># &lt;view logic&gt;</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;POST result&#x27;</span>)</span><br></pre></td></tr></table></figure><p>FBV关于url的配置略</p><p>1.2 CBV的实现如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># &lt;view logic&gt;</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;GET result&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># &lt;view logic&gt;</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;POST result&#x27;</span>)</span><br></pre></td></tr></table></figure><p>所有基于类的视图都必须继承View类，该类用来处理视图关联到URL的操作，具体分析如下：</p><p>由于django的URL解析器期望发送request以及相关参数给一个可调用的函数，而不是一个类，所以基于类的视图有一个as_view()类方法（该方法继承自父类View），调用该方法会返回URL解析器所期望的函数，该函数会在请求到达与关联模式匹配的URL时调用，就像调用视图函数一个样子。查看源码会发现调用该函数首先会创建一个MyView类的实例，然后</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、调用self.setup()方法，用于初始化一系列属性。</span><br><span class="line"><span class="number">2</span>、之后调用self.dispatch(),该方法查看request以确定本次请求是GET还是POST等，如果定义了匹配方法，则将请求转发给匹配方法；如果没有，则引发HttpResponseNotAllowed。本例中将调用我们自定义的get与post方法来响应请求</span><br><span class="line"></span><br><span class="line">ps：基于面向对象的知识，上述方法，如果子类MyView未重写，则去父类View中寻找</span><br></pre></td></tr></table></figure><p>urls.py的配置如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> myapp.views <span class="keyword">import</span> MyView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;about/&#x27;</span>, MyView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>虽然最精简的CBV不需要设置任何类属性就可以使用，但类属性确实在基于CBV的设计中非常有用，我们又两种方法可以配置或设置类属性</p><p>方法一：python标准的套路，在子类中重写/覆盖父类的属性和方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GreetingView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    greeting = <span class="string">&quot;Good Day&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(self.greeting)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以在子类中对属性进行重写</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MorningGreetingView</span>(<span class="title class_ inherited__">GreetingView</span>):</span><br><span class="line">    greeting = <span class="string">&quot;Morning to ya&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在url配置中使用子类调用as_view()方法即可</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> myapp.views <span class="keyword">import</span> MyView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;about/&#x27;</span>, MorningGreetingView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>方法二：在URL配置里为as_view()方法传递关键字参数来设置类属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;about/&#x27;</span>, GreetingView.as_view(greeting=<span class="string">&quot;G&#x27;day&quot;</span>)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意1：as_view方法只接受已经是类属性的参数，即在类GreetingView中必须已经有greeting属性，as_view只是一种覆盖操作</span></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GreetingView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    greeting = <span class="string">&quot;Good Day&quot;</span> <span class="comment"># 必须已经有了该属性</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(self.greeting)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意2：这种覆盖操作只在本条url匹配成功时生效一次</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 访问结果为覆盖后的属性值:&quot;G&#x27;day&quot;</span></span><br><span class="line">    path(<span class="string">&#x27;about/&#x27;</span>, GreetingView.as_view(greeting=<span class="string">&quot;G&#x27;day&quot;</span>)),</span><br><span class="line">    <span class="comment"># 访问结果仍为原值:&quot;Good Day&quot;</span></span><br><span class="line">    path(<span class="string">&#x27;about1/&#x27;</span>, views.GreetingView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="使用mixins"><a href="#使用mixins" class="headerlink" title="使用mixins"></a>使用mixins</h2><p>Mixins机制指的是子类混合(mixin)不同类的属性和功能，比如在django内置的通用视图里有一个mixin类叫TemplateResponseMixin，它的主要目的就是来定义一个方法render_to_response()。当该类和View类组合到一起时，就得到了TemplateView类，TemplateView类分发请求到相应的方法上（通过执行继承自View类的dispath()方法），并且使用render_to_response()方法来找到template_name属性读取指定的模板从而返回一个TemplateResponse对象（通过执行继承自TemplateResponseMixin类的render_to_response()方法）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic.base <span class="keyword">import</span> TemplateResponseMixin</span><br></pre></td></tr></table></figure><p>这就极大利用了面向对象重之多继承技术来重用代码的优点，但是鱼与熊掌不可兼得，需要付出的代价就是，在多继承背景下，我们定义的mixin类越多，代码的可读性越差。</p><p>关于mixins的用法详见官网<a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/3.0/topics/class-based-views/mixins/">https://docs.djangoproject.com/en/3.0/topics/class-based-views/mixins/</a>，篇幅问题此处不再累述。</p><p>需要强调的是，CBV可以继承多个mixins类（推荐写在左边），但是只能继承一个父类，该父类只能是View类或者其子/子孙类（推荐写在右面），同时继承两个父类将会导致你的子类无法按照预期那样工作。</p><h1 id="四、django内置的CBV"><a href="#四、django内置的CBV" class="headerlink" title="四、django内置的CBV"></a>四、django内置的CBV</h1><p>django内置了基本的CBV可以满足相当多的应用，所以的视图都继承自View类，View类负责处理将视图链接到url、HTTP方法调度和其他常见功能。内置的CBV如RedirectView提供了一个HTTP重定向，TemplateView扩展了基类，使其同时可以渲染一个模板。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> View,TemplateView,RedirectView</span><br></pre></td></tr></table></figure><h2 id="最简单的使用"><a href="#最简单的使用" class="headerlink" title="最简单的使用"></a>最简单的使用</h2><p>以TemplateView为例来介绍内置CBV的使用。最直接使用方式就是直接在URL配置中创建，如果只想改变该CBV的几个属性，你可以为as_view传递参数，如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> TemplateView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;about/&#x27;</span>, TemplateView.as_view(template_name=<span class="string">&quot;about.html&quot;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>一样的道理，如果我们想要重定向一个地址，可以设置RedirectView的url属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> RedirectView</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;index/&#x27;</span>, views.index),</span><br><span class="line">    path(<span class="string">&#x27;about/&#x27;</span>, RedirectView.as_view(url=<span class="string">&quot;/index/&quot;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="继承内置CBV进行重写"><a href="#继承内置CBV进行重写" class="headerlink" title="继承内置CBV进行重写"></a>继承内置CBV进行重写</h2><p>第二种更有效的使用内置CBV的方式就是是从现有视图继承并重写子类中的属性（例如template_name）或方法（例如get_context_data）,以提供新的值或方法。</p><p>例如，我们的需求是要定制一个视图，该视图专门用来显示/渲染模板about.html。Django有一个内置的CBV即TemplateView可以实现，因此我们可以继承它，并重写模板名称template_name以及用来获取渲染模板数据的方法get_context_data</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">views.py</button></li><li class="tab"><button type="button" data-href="#test4-2">url.py</button></li><li class="tab"><button type="button" data-href="#test4-3">templates/home.html</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.views.generic.base <span class="keyword">import</span> TemplateView</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomePageView</span>(<span class="title class_ inherited__">TemplateView</span>):</span><br><span class="line">    template_name = <span class="string">&quot;home.html&quot;</span> <span class="comment"># django会去templates目录下查找到该模板</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_context_data</span>(<span class="params">self, **kwargs</span>): <span class="comment"># 获取数据，用来渲染模块</span></span><br><span class="line">        context = <span class="built_in">super</span>().get_context_data(**kwargs)</span><br><span class="line"></span><br><span class="line">        context[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&quot;egon&quot;</span></span><br><span class="line">        context[<span class="string">&#x27;age&#x27;</span>] = <span class="string">&quot;18&quot;</span></span><br><span class="line">        context[<span class="string">&#x27;title&#x27;</span>] = <span class="string">&quot;dsb&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> context</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;home/&#x27;</span>, views.HomePageView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>更多内置CBV详见：</p><p><a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/3.0/topics/class-based-views/generic-display/">https://docs.djangoproject.com/en/3.0/topics/class-based-views/generic-display/</a></p><h1 id="五、使用CBV处理表单"><a href="#五、使用CBV处理表单" class="headerlink" title="五、使用CBV处理表单"></a>五、使用CBV处理表单</h1><p>请看完后续章节中关于表单的使用之后再来读本小节</p><p>FBV处理表单代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> MyForm <span class="comment"># forms.py内的MyForm表单类</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myview</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        form = MyForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            <span class="comment"># &lt;process form cleaned data&gt;</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/success/&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = MyForm(initial=&#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;form_template.html&#x27;</span>, &#123;<span class="string">&#x27;form&#x27;</span>: form&#125;)</span><br></pre></td></tr></table></figure><p>CBV处理表单代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> MyForm</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyFormView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    form_class = MyForm</span><br><span class="line">    initial = &#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;value&#x27;</span>&#125;</span><br><span class="line">    template_name = <span class="string">&#x27;form_template.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        form = self.form_class(initial=self.initial)</span><br><span class="line">        <span class="keyword">return</span> render(request, self.template_name, &#123;<span class="string">&#x27;form&#x27;</span>: form&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        form = self.form_class(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            <span class="comment"># &lt;process form cleaned data&gt;</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/success/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render(request, self.template_name, &#123;<span class="string">&#x27;form&#x27;</span>: form&#125;)</span><br></pre></td></tr></table></figure><p>上述只是一个很想的例子，但是我们可以定制这个视图，比如覆盖任意的类属性（例如form_class）,或者为as_view()传参，或者继承MyForView并重写其中方法。</p><p>更多表单处理详见：</p><p><a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/3.0/topics/class-based-views/generic-editing/">https://docs.djangoproject.com/en/3.0/topics/class-based-views/generic-editing/</a></p><h1 id="六、为CBV添加装饰器"><a href="#六、为CBV添加装饰器" class="headerlink" title="六、为CBV添加装饰器"></a>六、为CBV添加装饰器</h1><p>之前我们介绍过，若想要为CBV添加额外的功能，可以采用mixins机制，但除此之外，还可以通过添加装饰器的方法实现。有两个地方可以添加装饰</p><h2 id="装饰as-view-方法"><a href="#装饰as-view-方法" class="headerlink" title="装饰as_view()方法"></a>装饰as_view()方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入内置的装饰器</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required, permission_required </span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> TemplateView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .views <span class="keyword">import</span> VoteView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;about/&#x27;</span>, login_required(TemplateView.as_view(template_name=<span class="string">&quot;secret.html&quot;</span>))),</span><br><span class="line">    path(<span class="string">&#x27;vote/&#x27;</span>, permission_required(<span class="string">&#x27;polls.can_vote&#x27;</span>)(VoteView.as_view())),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>示例：</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">views.py</button></li><li class="tab"><button type="button" data-href="#test4-2">urls.py</button></li><li class="tab"><button type="button" data-href="#test4-3">login.html</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        ret = func(request, *args, **kwargs)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;函数执行的时间是&#123;&#125;&quot;</span>.<span class="built_in">format</span>(time.time() - start))</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># CBV视图</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        obj = <span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;egon&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;账号或密码错误&#x27;</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path <span class="keyword">from</span> app01.views <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">urlpatterns = [ path(<span class="string">&#x27;login/&#x27;</span>,timer(LoginView.as_view())), ] </span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        用户名：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        密码：</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>装饰as_views()相当于给视图类的中的所有方法（例如get、post）都加上了装饰器</p><h2 id="装饰视图类"><a href="#装饰视图类" class="headerlink" title="装饰视图类"></a>装饰视图类</h2><p>类方法与独立函数不完全相同，所以你不能简单地把函数装饰器加到类方法上，这就用到了method_decorator方法，该方法会将函数装饰器转换为方法装饰器，然后才可以用来装饰类方法，例如：</p><p>装饰dispatch方法，基于CBV，当请求过来后会先执行dispatch()这个方法进而分发到对用的get、post方法上，所以如果需要批量装饰处理请求的方法（如get，post等）可以为dispatch方法添加装饰，这与为as_view()添加装饰器效果时一样的，如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        ret = func(request, *args, **kwargs)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;函数执行的时间是&#123;&#125;&quot;</span>.<span class="built_in">format</span>(time.time() - start))</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># CBV视图</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="comment">#相当于给get,post请求都加上了装饰器</span></span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">timer</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        obj = <span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;egon&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;账号或密码错误&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ps：url配置中正常调用即可，无需重复装饰，下同</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> app01.views <span class="keyword">import</span> *</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;login/&#x27;</span>,LoginView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>我们当然可以单独装饰不同的方法，如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">......省略代码,同上</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        obj = <span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"><span class="meta">    @method_decorator(<span class="params">timer</span>) </span><span class="comment"># 只装饰get方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;egon&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;账号或密码错误&#x27;</span>)</span><br></pre></td></tr></table></figure><p>更简洁一点，我们可以把装饰器加在类上，通过name参数指定要装饰的方法，如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @method_decorator(timer,name=&#x27;dispatch&#x27;) # 批量添加</span></span><br><span class="line"><span class="meta">@method_decorator(<span class="params">timer,name=<span class="string">&#x27;get&#x27;</span></span>) </span><span class="comment"># 单独给get方法添加</span></span><br><span class="line"><span class="comment"># @method_decorator(timer,name=&#x27;post&#x27;) # 单独给post方法添加</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        obj = <span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;egon&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;账号或密码错误&#x27;</span>)</span><br></pre></td></tr></table></figure><p>如果有多个装饰器需要添加，可以定义一个列表或者元组将其存放起来，然后按照下述方式指定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义多个装饰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deco1</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;===&gt;deco1&#x27;</span>)</span><br><span class="line">        ret = func(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deco2</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;===&gt;deco2&#x27;</span>)</span><br><span class="line">        ret = func(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义装饰列表</span></span><br><span class="line">decorators = [deco1, deco2]</span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(<span class="params">decorators,name=<span class="string">&#x27;get&#x27;</span></span>) </span><span class="comment"># 为get方法添加多个装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        obj = <span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;egon&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;账号或密码错误&#x27;</span>)</span><br></pre></td></tr></table></figure><p>上述装饰器会按照列表规定的顺序依次执行装饰器，即先执行deco1，然后deco2。。。与下述添加方式是等同的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">......省略代码,同上</span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(<span class="params">deco1,name=<span class="string">&#x27;get&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@method_decorator(<span class="params">deco2,name=<span class="string">&#x27;get&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        obj = <span class="built_in">super</span>().dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;egon&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;账号或密码错误&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="七、支持其他的HTTP方法"><a href="#七、支持其他的HTTP方法" class="headerlink" title="七、支持其他的HTTP方法"></a>七、支持其他的HTTP方法</h1><p>假设我们写了一个图书管理系统，如果有人想使用视图作为API通过HTTP协议访问我们的图书库。API客户端想要获取最新的图书数据，需要时不时地发起连接并下载自上次访问以来新出版的图书数据。但是如果自上次访问完后，就没有新的图书出版，那么从数据库查询图书信息，渲染一个完整的reponse并发送给客户端将白白耗费CPU时间和带宽，此时，我们最好的方式，就是在得知有新书出版时才发起一次请求完整数据的的API调用，这就用到了head方法来查询是否有数据更新</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">urls.py</button></li><li class="tab"><button type="button" data-href="#test4-2">views.py</button></li><li class="tab"><button type="button" data-href="#test4-3">models.py</button></li><li class="tab"><button type="button" data-href="#test4-4">settings.py</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> app01.views <span class="keyword">import</span> BookListView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, BookListView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> ListView</span><br><span class="line"><span class="keyword">from</span> app01.models <span class="keyword">import</span> Book</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookListView</span>(<span class="title class_ inherited__">ListView</span>):</span><br><span class="line">    model = Book</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">head</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        last_book = self.get_queryset().latest(<span class="string">&#x27;publication_date&#x27;</span>)</span><br><span class="line">        response = HttpResponse()</span><br><span class="line"></span><br><span class="line">        response[<span class="string">&#x27;Last-Modified&#x27;</span>] = last_book.publication_date.strftime(<span class="string">&#x27;%Y-%m-%d %X&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        返回完整的数据，此处我们简单地用返回所有书籍名字代表将要返回的完整数据</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        books=Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        names=<span class="string">&#x27;|&#x27;</span>.join([book.name <span class="keyword">for</span> book <span class="keyword">in</span> books])</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(names)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    name=models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    publication_date=models.DateTimeField(auto_now_add=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-4"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TIME_ZONE = <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">USE_TZ = <span class="literal">False</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://jerrrywang.github.io">JerryWang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://jerrrywang.github.io/2021/11/03/Python/Django/Django%E4%B9%8B%E6%97%85/3.Django%E4%B9%8B%E8%A7%86%E5%9B%BE%E5%B1%82/">https://jerrrywang.github.io/2021/11/03/Python/Django/Django之旅/3.Django之视图层/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jerrrywang.github.io" target="_blank">JerryWang</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="social-share" data-image="https://jerrrywang.github.io/2018/10/11/photo/ming_2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/05/Python/Django/Django%E4%B9%8B%E6%97%85/4.Django%E4%B9%8B%E6%A8%A1%E7%89%88%E5%B1%82/"><img class="prev-cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_1.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Django之模版层</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/02/Python/Django/Django%E4%B9%8B%E6%97%85/2.Django%E4%B9%8B%E8%B7%AF%E7%94%B1%E5%B1%82/"><img class="next-cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_0.jpeg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Django之路由层(URL调度器)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/11/29/Python/Django/Django-RESTframework/1.%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83/" title="接口规范"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-29</div><div class="title">接口规范</div></div></a></div><div><a href="/2021/11/30/Python/Django/Django-RESTframework/2.%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E7%BB%84%E4%BB%B6/" title="请求响应组件"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-30</div><div class="title">请求响应组件</div></div></a></div><div><a href="/2021/12/06/Python/Django/Django-RESTframework/3.%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%84%E4%BB%B6/" title="序列化组件"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-06</div><div class="title">序列化组件</div></div></a></div><div><a href="/2021/12/10/Python/Django/Django-RESTframework/5.%E4%B8%89%E5%A4%A7%E8%AE%A4%E8%AF%81%E7%BB%84%E4%BB%B6/" title="三大认证组件"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-10</div><div class="title">三大认证组件</div></div></a></div><div><a href="/2021/12/08/Python/Django/Django-RESTframework/4.%E8%A7%86%E5%9B%BE%E7%BB%84%E4%BB%B6/" title="视图组件"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-08</div><div class="title">视图组件</div></div></a></div><div><a href="/2021/12/15/Python/Django/Django-RESTframework/6.jwt%E8%AE%A4%E8%AF%81/" title="jwt认证"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-15</div><div class="title">jwt认证</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC80NTg2Ni8yMjM3Nw"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">JerryWang</div><div class="author-info__description">再牛逼的梦想，也抵不过傻逼一样的坚持！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">140</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">87</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" href="https://jerrrywang.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/JerrryWang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wjy_0316@126.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://weibo.com/allenaq/" target="_blank" title="WeiBo"><i class="fab fa-zhihu"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;低级的欲望,放纵即可获得<br>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;高级的欲望,克制才能得到</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%AF%B7%E6%B1%82%E4%B8%8E%E7%9B%B8%E5%BA%94"><span class="toc-number">1.</span> <span class="toc-text">一、请求与相应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1%EF%BC%88HttpReques%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">请求对象（HttpReques）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpRequest%E5%AF%B9%E8%B1%A1%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7part1"><span class="toc-number">1.1.1.</span> <span class="toc-text">HttpRequest对象常用属性part1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpRequest%E5%AF%B9%E8%B1%A1%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7part2"><span class="toc-number">1.1.2.</span> <span class="toc-text">HttpRequest对象常用属性part2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpRequest%E5%AF%B9%E8%B1%A1%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7part3"><span class="toc-number">1.1.3.</span> <span class="toc-text">HttpRequest对象常用属性part3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpRequest%E5%AF%B9%E8%B1%A1%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7part4%EF%BC%88%E6%9A%82%E4%BD%9C%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-number">1.1.4.</span> <span class="toc-text">HttpRequest对象常用属性part4（暂作了解）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.</span> <span class="toc-text">响应对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpResponse"><span class="toc-number">1.2.1.</span> <span class="toc-text">HttpResponse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#render"><span class="toc-number">1.2.2.</span> <span class="toc-text">render</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redirect"><span class="toc-number">1.2.3.</span> <span class="toc-text">redirect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonResponse"><span class="toc-number">1.2.4.</span> <span class="toc-text">JsonResponse</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">二、异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#django%E5%86%85%E7%BD%AE%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%A7%86%E5%9B%BE"><span class="toc-number">2.1.</span> <span class="toc-text">django内置异常处理视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E8%A7%86%E5%9B%BE"><span class="toc-number">2.2.</span> <span class="toc-text">自定义异常处理视图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81FBV%E4%B8%8ECBV"><span class="toc-number">3.</span> <span class="toc-text">三、FBV与CBV</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-number">3.1.</span> <span class="toc-text">引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8CBV"><span class="toc-number">3.2.</span> <span class="toc-text">使用CBV</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95%E6%9D%A5%E5%93%8D%E5%BA%94%E4%B8%8D%E5%90%8C%E7%9A%84HTTP%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.</span> <span class="toc-text">使用不同的实例方法来响应不同的HTTP请求方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8mixins"><span class="toc-number">3.4.</span> <span class="toc-text">使用mixins</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81django%E5%86%85%E7%BD%AE%E7%9A%84CBV"><span class="toc-number">4.</span> <span class="toc-text">四、django内置的CBV</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">最简单的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%86%85%E7%BD%AECBV%E8%BF%9B%E8%A1%8C%E9%87%8D%E5%86%99"><span class="toc-number">4.2.</span> <span class="toc-text">继承内置CBV进行重写</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8CBV%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95"><span class="toc-number">5.</span> <span class="toc-text">五、使用CBV处理表单</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%B8%BACBV%E6%B7%BB%E5%8A%A0%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">六、为CBV添加装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0as-view-%E6%96%B9%E6%B3%95"><span class="toc-number">6.1.</span> <span class="toc-text">装饰as_view()方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">6.2.</span> <span class="toc-text">装饰视图类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%94%AF%E6%8C%81%E5%85%B6%E4%BB%96%E7%9A%84HTTP%E6%96%B9%E6%B3%95"><span class="toc-number">7.</span> <span class="toc-text">七、支持其他的HTTP方法</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/02/Python/Django/Django%E4%B9%8B%E6%97%85/16.%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E5%99%A8/" title="无题"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_10.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="无题"></a><div class="content"><a class="title" href="/2022/12/02/Python/Django/Django%E4%B9%8B%E6%97%85/16.%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E5%99%A8/" title="无题">无题</a><time datetime="2022-12-02T07:46:37.000Z" title="发表于 2022-12-02 15:46:37">2022-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/07/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E9%80%9A%E8%BF%87%20SSH%20%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%9C%AC%E5%9C%B0%20Shell%20%E8%84%9A%E6%9C%AC/" title="通过 SSH 链接服务器运行本地 Shell 脚本"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="通过 SSH 链接服务器运行本地 Shell 脚本"></a><div class="content"><a class="title" href="/2022/11/07/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E9%80%9A%E8%BF%87%20SSH%20%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%9C%AC%E5%9C%B0%20Shell%20%E8%84%9A%E6%9C%AC/" title="通过 SSH 链接服务器运行本地 Shell 脚本">通过 SSH 链接服务器运行本地 Shell 脚本</a><time datetime="2022-11-07T04:35:30.000Z" title="发表于 2022-11-07 12:35:30">2022-11-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/13/Python/%E6%A8%A1%E5%9D%97/loguru%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" title="loguru日志模块的使用"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_10.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="loguru日志模块的使用"></a><div class="content"><a class="title" href="/2022/07/13/Python/%E6%A8%A1%E5%9D%97/loguru%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" title="loguru日志模块的使用">loguru日志模块的使用</a><time datetime="2022-07-13T01:10:19.000Z" title="发表于 2022-07-13 09:10:19">2022-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/13/Python/%E6%A8%A1%E5%9D%97/tarfile%E6%A8%A1%E5%9D%97/" title="tarfile压缩模块的使用"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_5.jpeg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="tarfile压缩模块的使用"></a><div class="content"><a class="title" href="/2022/07/13/Python/%E6%A8%A1%E5%9D%97/tarfile%E6%A8%A1%E5%9D%97/" title="tarfile压缩模块的使用">tarfile压缩模块的使用</a><time datetime="2022-07-13T01:10:19.000Z" title="发表于 2022-07-13 09:10:19">2022-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/12/Python/%E6%A8%A1%E5%9D%97/python%E7%BB%99%E5%9B%BE%E7%89%87%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E6%B0%B4%E5%8D%B0filestools%E6%A8%A1%E5%9D%97/" title="python给图片批量添加水印filestools模块"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="python给图片批量添加水印filestools模块"></a><div class="content"><a class="title" href="/2022/07/12/Python/%E6%A8%A1%E5%9D%97/python%E7%BB%99%E5%9B%BE%E7%89%87%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E6%B0%B4%E5%8D%B0filestools%E6%A8%A1%E5%9D%97/" title="python给图片批量添加水印filestools模块">python给图片批量添加水印filestools模块</a><time datetime="2022-07-12T01:00:19.000Z" title="发表于 2022-07-12 09:00:19">2022-07-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By JerryWang</div><div class="footer_custom_text"><a href="https://jerrrywang.github.io">生活要像水墨画一样的浓厚多姿</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){GLOBAL_CONFIG_SITE.isPost&&panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><script>function loadLivere(){var e,t,o,r;"object"==typeof LivereTower?window.LivereTower.init():(e=document,t="script",r=e.getElementsByTagName(t)[0],"function"!=typeof LivereTower&&((o=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",o.async=!0,r.parentNode.insertBefore(o,r)))}{function loadOtherComment(){loadLivere()}loadLivere()}</script></div><div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-order="random"></div><script id="canvas_nest" defer color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU,JerryWang,超帥,富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),"object"==typeof preloader&&preloader.initLoading(),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>var font="Ringing"</script><script data-pjax>function electric_clock_injector_config(){var c=document.getElementsByClassName("sticky_layout")[0];console.log("已挂载electric_clock"),c.insertAdjacentHTML("afterbegin",'<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://jerrrywang.github.io/api/shubiao/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&(location.pathname,1)&&electric_clock_injector_config()</script><script src="https://jerrrywang.github.io/api/jquery.min.js"></script><script>loc=$.ajax({url:"https://ipapi.co/json/",type:"GET",dataType:"json",async:!1,success:function(e){}}),ip=$.parseJSON(loc.responseText).ip,version=$.parseJSON(loc.responseText).version,city=$.parseJSON(loc.responseText).city,country=$.parseJSON(loc.responseText).country_name</script><script data-pjax src="https://jerrrywang.github.io/api/npm/hexo-electric-clock-plus/clock.js"></script></body></html>