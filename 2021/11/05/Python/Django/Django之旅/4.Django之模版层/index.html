<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Django之模版层 | JerryWang</title><meta name="keywords" content="Django"><meta name="author" content="JerryWang"><meta name="copyright" content="JerryWang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一 模板简介 在刚刚介绍完的视图层中我们提到，浏览器发送的请求信息会转发给视图进行处理，而视图在经过一系列处理后必须要有返回信息给浏览器。如果我们要返回html标签、css等数据给浏览器进行渲染，我们可以在视图中这么做 12345678910111213from django.shortcuts import HttpResponseimport time# 返回静态内容(静态页面)：页面内容固定"><meta property="og:type" content="article"><meta property="og:title" content="Django之模版层"><meta property="og:url" content="https://jerrrywang.github.io/2021/11/05/Python/Django/Django%E4%B9%8B%E6%97%85/4.Django%E4%B9%8B%E6%A8%A1%E7%89%88%E5%B1%82/index.html"><meta property="og:site_name" content="JerryWang"><meta property="og:description" content="一 模板简介 在刚刚介绍完的视图层中我们提到，浏览器发送的请求信息会转发给视图进行处理，而视图在经过一系列处理后必须要有返回信息给浏览器。如果我们要返回html标签、css等数据给浏览器进行渲染，我们可以在视图中这么做 12345678910111213from django.shortcuts import HttpResponseimport time# 返回静态内容(静态页面)：页面内容固定"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg"><meta property="article:published_time" content="2021-11-05T04:18:58.000Z"><meta property="article:modified_time" content="2022-12-02T06:45:43.000Z"><meta property="article:author" content="JerryWang"><meta property="article:tag" content="Django"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://jerrrywang.github.io/2021/11/05/Python/Django/Django%E4%B9%8B%E6%97%85/4.Django%E4%B9%8B%E6%A8%A1%E7%89%88%E5%B1%82/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://jerrrywang.github.io/api/shubiao/Cyan.ttf" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"NL6QRV8F8M",apiKey:"0b99ef5723aa77799f47331a0e3bc4ff",indexName:"my-blog",hits:{per_page:6},languages:{input_placeholder:"搜索文章",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,noticeOutdate:{limitDay:30,position:"top",messagePrev:"本文上次更新于",messageNext:"天前，文章内容可能已经过时。"},highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!0},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:50,languages:{author:"作者: JerryWang",link:"链接: ",source:"来源: JerryWang",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css"}},isPhotoFigcaption:!0,islazyload:!1,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Django之模版层",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-12-02 14:45:43"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const a=864e5*o,n={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(n))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const a=document.createElement("script");a.src=e,a.async=!0,a.onerror=o,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=(new Date).getHours();void 0===t?o<=6||o>=18?activateDarkMode():activateLightMode():"light"===t?activateLightMode():activateDarkMode();const a=saveToLocal.get("aside-status");void 0!==a&&("hide"===a?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="/js/welcome.js"></script><script src="/js/sweetalert.js"></script><script src="/api/shubiao/sakuraDrops.js"></script><link rel="stylesheet" href="/css/sweetalert.css"><style>#toggle-sidebar{left:100px}</style><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://jerrrywang.github.io/api/npm/hexo-electric-clock-plus/clock.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">155</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">90</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时光轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-coffee"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-bicycle"></i> <span>相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-heartbeat"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-motorcycle"></i> <span>清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i> <span>电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i> <span>书籍</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">JerryWang</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时光轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-coffee"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-bicycle"></i> <span>相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-heartbeat"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-motorcycle"></i> <span>清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i> <span>电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i> <span>书籍</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django之模版层</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-05T04:18:58.000Z" title="发表于 2021-11-05 12:18:58">2021-11-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-02T06:45:43.000Z" title="更新于 2022-12-02 14:45:43">2022-12-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django/">Django</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django/Django%E4%B9%8B%E6%97%85/">Django之旅</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>65分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Django之模版层"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一-模板简介"><a href="#一-模板简介" class="headerlink" title="一 模板简介"></a>一 模板简介</h2><p>在刚刚介绍完的视图层中我们提到，浏览器发送的请求信息会转发给视图进行处理，而视图在经过一系列处理后必须要有返回信息给浏览器。如果我们要返回html标签、css等数据给浏览器进行渲染，我们可以在视图中这么做</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回静态内容(静态页面)：页面内容固定不变</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    html = <span class="string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;静态内容，固定不变&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回动态内容(动态页面)：后台处理会用变量值填充内容，每次得到的内容都可能不同</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">current_datetime</span>(<span class="params">request</span>):</span><br><span class="line">    now_time = time.strftime(<span class="string">&#x27;%Y-%m-%d %X&#x27;</span>)</span><br><span class="line">    html = <span class="string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;动态内容，%s&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span> % now_time</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br></pre></td></tr></table></figure><p>上例所示，我们直接将HTML代码放到视图里，然后进行返回，这可以使我们很直观地看清楚浏览器从发送请求到看到前端界面内容的这个过程中视图的基本工作原理，但是这种将前端代码与后端代码完全耦合到了一起开发方式会使得程序的可维护性与可扩展性变差</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">前端界面一旦需要重新设计、修改，则必须对后端的Python代码进行相应的修改。 然而前端界面的修改往往比后端 Python 代码的修改要频繁得多，因此如果可以在不进行 Python 代码修改的情况下变更前端界面的设计，那将会方便得多。</span><br></pre></td></tr></table></figure><p>我们可以很容易想到的解决方案就是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、首先将前端代码放入单独的HTML文件中</span></span><br><span class="line"><span class="comment"># 2、然后编写查找/加载这些文件的统一方法/API（否则需要在每个视图里重复编写查找/加载的代码）。</span></span><br></pre></td></tr></table></figure><p>作为一个成熟的Web框架，上述方案早已被Django实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、Django提供了模板系统 (Template System)用来专门定制html文件，一个html文件称之为一个模板</span></span><br><span class="line">    对于静态页面来说，直接编写就好</span><br><span class="line">    而针对动态页面，django额外提供了专门的模板语言(Django template language，简称DTL)，允许我们在页     </span><br><span class="line">    面中嵌入模板变量，这便为后期为页面动态填充内容提供了可能性。</span><br><span class="line">    DTL是模板系统的核心，因此django的模板系统也被等同于DTL</span><br><span class="line"></span><br><span class="line">    详见第三小节</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、Django定义了一套标准的API用来查找/加载（读取并进行预处理称之为加载）并且渲染模板</span></span><br><span class="line">    渲染rendering指的是用上下文数据context data插入/填充模板并返回结果，结果为字符串。</span><br><span class="line">    将要插入/填充入模板的变量组织到一个字典里，该字典称之为上个文context data</span><br><span class="line"></span><br><span class="line">    详见第二小节-&gt;<span class="number">2.1</span></span><br></pre></td></tr></table></figure><p>一个简单的示例如下</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">templates/index.html</button></li><li class="tab"><button type="button" data-href="#test4-2">templates/current_datetime.html</button></li><li class="tab"><button type="button" data-href="#test4-3">views.py</button></li><li class="tab"><button type="button" data-href="#test4-4">urls.py</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>静态内容，固定不变<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>动态内容，&#123;&#123; now &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回静态内容(静态页面)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回动态内容(动态页面)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">current_datetime</span>(<span class="params">request</span>):</span><br><span class="line">    now_time = time.strftime(<span class="string">&#x27;%Y-%m-%d %X&#x27;</span>)</span><br><span class="line">    context=&#123;<span class="string">&quot;now&quot;</span>:now_time&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;current_datetime.html&#x27;</span>,context)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-4"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> app01.views <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;index/&#x27;</span>, index),</span><br><span class="line">    path(<span class="string">&#x27;current_datetime/&#x27;</span>, current_datetime),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="二-模板的使用"><a href="#二-模板的使用" class="headerlink" title="二 模板的使用"></a>二 模板的使用</h2><h3 id="2-1-标准API"><a href="#2-1-标准API" class="headerlink" title="2.1 标准API"></a>2.1 标准API</h3><p>Django内置了一套标准API（兼容任何模板引擎的BACKEND）用于查找/加载、渲染模板。历史原因，模板的相关实现都存在于django.template名称空间中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例如</span></span><br><span class="line"><span class="comment"># 1、django.template.loader 加载器，定义了函数get_template与select_template用于模板的查找</span></span><br><span class="line">get_template(template_name, using=<span class="literal">None</span>)</span><br><span class="line">select_template(template_name_list, using=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、django.template.backends 模板引擎后端实现</span></span><br><span class="line">django.template.backends.django.DjangoTemplates</span><br><span class="line">django.template.backends.jinja2.Jinja2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、Template.render(context=None, request=None) 用于渲染模板</span></span><br><span class="line"><span class="keyword">from</span> django.template.backends.django <span class="keyword">import</span> Template</span><br><span class="line"><span class="keyword">from</span> django.template.backends.jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、django.template.loader.render_to_string 是一个快捷方法，内部就是调用1和3的API</span></span><br><span class="line">render_to_string(template_name, context=<span class="literal">None</span>, request=<span class="literal">None</span>, using=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若想深入了解，可以参照官网来阅读源码https://docs.djangoproject.com/en/3.0/topics/templates/#usage</span></span><br></pre></td></tr></table></figure><p>上述API了解即可，因为我们在日常开发过程中，常用的一个render方法（from django.shortcuts import render），其内部已经整合了上述API。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="comment">#  通过查看源码会发现render内部就是在调用上述API</span></span><br><span class="line">render(request, template_name, context=<span class="literal">None</span>, content_type=<span class="literal">None</span>, status=<span class="literal">None</span>, using=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>render参数介绍，详细使用见下一小节</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、request就是一个HttpRequest对象</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、template_name:</span><br><span class="line">    可以是一个单独的模板</span><br><span class="line">        <span class="string">&#x27;story_detail.html&#x27;</span></span><br><span class="line">        <span class="string">&#x27;news/story_detail.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    也可以是一个模板列表</span><br><span class="line">        [<span class="string">&#x27;story_1_detail.html&#x27;</span>, <span class="string">&#x27;story_detail.html&#x27;</span>]</span><br><span class="line"><span class="number">3</span>、context：</span><br><span class="line">    是一个字典，包含了将要插入/填充入模板的变量，称之为上个文数据（context data）</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>、content_type</span><br><span class="line">    指定响应的内容类型，如content_type=<span class="string">&#x27;text/plain; charset=utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>、status：</span><br><span class="line">    指定响应的状态码，如status=<span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="number">6</span>、using：</span><br><span class="line">    指定使用的模板引擎名字，如using=<span class="string">&#x27;name1&#x27;</span>，代表使用名为name1的模板引擎</span><br></pre></td></tr></table></figure><h3 id="2-2-模板引擎配置"><a href="#2-2-模板引擎配置" class="headerlink" title="2.2 模板引擎配置"></a>2.2 模板引擎配置</h3><p>要解析DTL，需要有专门的解析器，称之为template engine模板引擎，需要在settings.py中配置TEMPLATES列表，其默认值为空，但在创建项目时会自动生成如下配置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>列表中一个字典就是一个引擎配置，一个django项目可以配置一个或多个模板引擎（当然，如果你不需要使用模板，也可以不配置），如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    <span class="comment"># 引擎配置一</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)],  </span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上，篇幅问题，下述带有同上字样的请读者在测试时自行填充上述代码 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 引擎配置二</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.jinja2.Jinja2&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)],  </span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>1）关键配置项之BACKEND：</p><p>每个引擎都需要有专门的后端程序BACKEND，BACKEND的值为要导入的python类，Django为自己的模块系统以及非常受欢迎的Jinja2模板系统内置了后端</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">django.template.backends.django.DjangoTemplates</span><br><span class="line"></span><br><span class="line">django.template.backends.jinja2.Jinja2</span><br></pre></td></tr></table></figure><p>而其他模板语言的后端需要从第三方获得。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、基于安全性考虑，最好不要使用不知名作者开发的第三方模板系统</span></span><br><span class="line"><span class="comment">#2、如果你不是必须选择其他的模板系统，还是推荐使用DTL</span></span><br></pre></td></tr></table></figure><p>2）关键配置项之DIRS与APP_DIRS</p><p>由于大多数引擎加载的模板都是文件，这就涉及到文件的路径查找，所以在每个引擎配置的顶级都包含两个相似的配置来专门负责路径查找问题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;DIRS&#x27;</span>: [], </span><br><span class="line"><span class="number">1</span>、列表中包含一系列的目录，引擎会按照列表的顺序依次查找模板文件</span><br><span class="line"><span class="number">2</span>、列表为空则代表没有对应的查找目录</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>, <span class="comment"># 默认为False</span></span><br><span class="line"><span class="number">1</span>、APP_DIRS 值为<span class="literal">True</span>时，会去按照INSTALLED_APPS = []中注册的app顺序，依次去每个app目录下的templates目录中查找模板文件</span><br><span class="line"><span class="number">2</span>、APP_DIRS 值为<span class="literal">False</span>时，不会检索app目录下的templates目录  </span><br></pre></td></tr></table></figure><p>查找的优先级为： djanog会先依次检索每个引擎下的DIRS，然后按照APP_DIRS的规定去找模板，直到找到为止。下面我们就依次举例进行验证</p><p>我们先将ARR_DIRS设置为False来讨论加载顺序，如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># django引擎</span></span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;/home/html/example.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/home/html/default&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">False</span>, <span class="comment"># 关闭去每个APP下查找，不设置默认值为False</span></span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># jinja2引擎</span></span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.jinja2.Jinja2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;/home/html/jinja2&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">False</span>, <span class="comment"># 关闭去每个APP下查找，不设置默认值为False</span></span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>若调用render(request,‘story_detail.html’)，查找顺序如下，找到为止</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、先检索列表中的第一个引擎，即&#x27;django&#x27; 引擎</span></span><br><span class="line">/home/html/example.com/story_detail.html </span><br><span class="line">/home/html/default/story_detail.html </span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、再检索列表中的第二个引擎，即&#x27;jinja2&#x27; 引擎</span></span><br><span class="line">/home/html/jinja2/story_detail.html</span><br></pre></td></tr></table></figure><p>若调用render(request,[‘story_1_detail.html’, ‘story_detail.html’])，查找顺序如下，找到为止</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一：首先查找模板story_1_detail.html</span></span><br><span class="line"><span class="comment"># 1.1、先检索列表中的第一个引擎，即&#x27;django&#x27; 引擎</span></span><br><span class="line">/home/html/example.com/story_1_detail.html</span><br><span class="line">/home/html/default/story_1_detail.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.2、再检索列表中的第二个引擎，即&#x27;jinja2&#x27; 引擎</span></span><br><span class="line">/home/html/jinja2/story_1_detail.html </span><br><span class="line"></span><br><span class="line"><span class="comment"># 二：其次查找模板story_detail.html</span></span><br><span class="line"><span class="comment"># 2.1、先检索列表中的第一个引擎，即&#x27;django&#x27; 引擎</span></span><br><span class="line">/home/html/example.com/story_detail.html </span><br><span class="line">/home/html/default/story_detail.html </span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.2、再检索列表中的第二个引擎，即&#x27;jinja2&#x27; 引擎</span></span><br><span class="line">/home/html/jinja2/story_detail.html</span><br></pre></td></tr></table></figure><p>所以针对[‘story_1_detail.html’, ‘story_detail.html’]，后一个模板通常作为第一个模板的备胎，从而保障第一个模板在未找到时依然能够找到模板作为替代品，这样便可以使我们的代码更为灵活，如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">article</span>(<span class="params">request, article_id</span>):</span><br><span class="line">    first_template = <span class="string">&#x27;article%s.html&#x27;</span> % article_id</span><br><span class="line">    bak_template = <span class="string">&#x27;article.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, [first_template, bak_template])</span><br></pre></td></tr></table></figure><p>然后我们ARR_DIRS设置为True来讨论完整的加载顺序，需要事先在每个app目录下顶层建立目录templates（注意，目录名字必须为templates），</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/Users/linhaifeng/PycharmProjects/allenPro</span><br><span class="line">├── app01</span><br><span class="line">│   ├── templates <span class="comment"># 目录名必须为templates</span></span><br><span class="line">├── app02</span><br><span class="line">│   ├── templates <span class="comment"># 目录名必须为templates</span></span><br></pre></td></tr></table></figure><p>然后配置如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># django引擎</span></span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;/home/html/aaa&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/home/html/bbb&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>, <span class="comment"># 关闭去每个APP下查找，不设置默认值为False</span></span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># jinja2引擎</span></span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.jinja2.Jinja2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [</span><br><span class="line">            <span class="string">&#x27;/home/html/ccc&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>, <span class="comment"># 关闭去每个APP下查找，不设置默认值为False</span></span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>若调用render(request,‘story_detail.html’)，查找顺序如下，找到为止</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一：djanog会先依次检索每个引擎下的DIRS</span></span><br><span class="line"><span class="comment"># 1.1、先检索列表中的第一个引擎，即&#x27;django&#x27; 引擎</span></span><br><span class="line">/home/html/aaa/story_detail.html </span><br><span class="line">/home/html/bbb/story_detail.html </span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.2、再检索列表中的第二个引擎，即&#x27;jinja2&#x27; 引擎</span></span><br><span class="line">/home/html/ccc/story_detail.html </span><br><span class="line"></span><br><span class="line"><span class="comment"># 二：因为APP_DIRS:True,所以接下来会按照INSTALLED_APPS中注册app的顺序，依次去每个app下的templates目录里查找</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># ......</span></span><br><span class="line">    <span class="string">&#x27;app02.apps.App02Config&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app01.apps.App01Config&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.1 先检索app02下的tempaltes目录</span></span><br><span class="line">/Users/linhaifeng/PycharmProjects/allenPro/app02/templates/story_detail.html</span><br><span class="line"><span class="comment"># 2.2 再检索app01下的tempaltes目录</span></span><br><span class="line">/Users/linhaifeng/PycharmProjects/allenPro/app01/templates/story_detail.html</span><br></pre></td></tr></table></figure><p>ps:针对render(request,[‘story_1_detail.html’, ‘story_detail.html’])，会按照列表中规定的模板顺序依次重复上述查找步骤，直到某一模板查找成功为止。</p><p>在一个项目的实际开发过程中，通常会包含多个app，多个app会有一些公共的模板文件，同时每个app也都会有自己对应的模板文件，要想清晰地组织这些模板，有如下两种解决方案</p><p>方案一：设置ARR_DIRS为False</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一：在项目根目录下的templates目录中新建子目录用来区分不同的模板归属</span></span><br><span class="line">/Users/linhaifeng/PycharmProjects/allenPro</span><br><span class="line">├── templates</span><br><span class="line">│   ├── base <span class="comment"># 用于存放公共模板</span></span><br><span class="line">│   │   ├── base.html</span><br><span class="line">│   ├── app01 <span class="comment"># 用于存放app01单独的模板</span></span><br><span class="line">│   │   ├── index.html</span><br><span class="line">│   ├── app02 <span class="comment"># 用于存放app02单独的模板</span></span><br><span class="line">│   │   ├── index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#二：配置如下</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    <span class="comment"># 引擎配置一</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)],  </span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#三：渲染方式</span></span><br><span class="line">render(request,<span class="string">&#x27;base/base.html&#x27;</span>)</span><br><span class="line">render(request,<span class="string">&#x27;app01/index.html&#x27;</span>)</span><br><span class="line">render(request,<span class="string">&#x27;app02/index.html&#x27;</span>)</span><br></pre></td></tr></table></figure><p>方案二：设置ARR_DIRS为True（推荐使用）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一：在ARR_DIRS为True的情况下，会检索每个app的templates目录，所以需要事先创建好下述目录：</span></span><br><span class="line"><span class="number">1</span>、项目根目录/templates</span><br><span class="line"><span class="number">2</span>、项目根目录/app01/templates <span class="comment"># 目录名字必须为templates</span></span><br><span class="line"><span class="number">3</span>、项目根目录/app02/templates <span class="comment"># 目录名字必须为templates</span></span><br><span class="line"></span><br><span class="line">注意：如果只创建到这一层就结束了，会出现冲突</span><br><span class="line">比如render(request,<span class="string">&#x27;index.html&#x27;</span>),在三个目录中都存在同名模板的情况下，查找优先级会是<span class="number">1</span>，<span class="number">2</span>，<span class="number">3</span>(假设只有配置了一个引擎，且app的注册顺序为app01、app02)。</span><br><span class="line">如果我们既想清晰地组织模板的目录结构，又想找到指定的模板、避免冲突，那么需要在<span class="number">1</span>、<span class="number">2</span>、<span class="number">3</span>的基础上继续建立子目录，子目录名无所谓，但其发挥的作用，相当于名称空间了，如下</span><br><span class="line">/Users/linhaifeng/PycharmProjects/allenPro</span><br><span class="line">├── templates</span><br><span class="line">│   ├── base </span><br><span class="line">│   │   ├── base.html </span><br><span class="line">├── app02</span><br><span class="line">│   ├── templates</span><br><span class="line">│   │   └── app01</span><br><span class="line">│   │       └── index.html </span><br><span class="line">├── app02</span><br><span class="line">│   ├── templates</span><br><span class="line">│   │   └── app02</span><br><span class="line">│   │       └── index.html </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#二：配置如下</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    <span class="comment"># 引擎配置一</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)],  </span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#三：渲染方式</span></span><br><span class="line"><span class="comment"># 最终找到的位置/templates/base/base.html</span></span><br><span class="line">render(request,<span class="string">&#x27;base/base.html&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终找到的位置/app01/templates/app01/index.html</span></span><br><span class="line">render(request,<span class="string">&#x27;app01/index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终找到的位置/app02/templates/app02/index.html</span></span><br><span class="line">render(request,<span class="string">&#x27;app02/index.html&#x27;</span>)</span><br></pre></td></tr></table></figure><p>（3）关键配置项目之NAME</p><p>在调用render()时，除非指定了引擎，否则会按照列表规定的顺序依次使用引擎来查找/加载模板，直到查找/加载成功为止。</p><p>如果想选用指定的模板引擎，需要使用参数NAME为每个模板引擎设定唯一的名字，然后在render中使用using参数指定即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一：settings.py配置如下</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    <span class="comment"># 引擎配置一</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;b1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;aaa&#x27;</span>)],    </span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment"># 引擎配置二</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;b2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;bbb&#x27;</span>)],    </span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="comment"># ... 同上 ...</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#二：为render函数指定using参数</span></span><br><span class="line">render(request, <span class="string">&#x27;index.html&#x27;</span>,using=<span class="string">&#x27;b1&#x27;</span>) <span class="comment"># b1-&gt;限定使用引擎配置一</span></span><br><span class="line">render(request, <span class="string">&#x27;index.html&#x27;</span>,using=<span class="string">&#x27;b2&#x27;</span>) <span class="comment"># b2-&gt;限定使用引擎配置二</span></span><br></pre></td></tr></table></figure><p>ps：如果没有设定参数NAME，那么引擎的名字默认为BACKEND按照点为分隔符的倒数第二个值，例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span> 引擎名字为django</span><br><span class="line"><span class="string">&#x27;django.template.backends.jinja2.Jinja2&#x27;</span>          引擎名字为jinjia2</span><br></pre></td></tr></table></figure><p>（4）关键配置项之OPTIONS</p><p>OPTIONS值为一字典，包含了要传递到模板后端的额外参数。比如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"># ......</span></span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>我们在模板中常用的变量就是’django.template.context_processors.request’的功劳。</p><p>更多配置项请参照官网<a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/3.0/topics/templates/%23module-django.template.backends.django">https://docs.djangoproject.com/</a></p><h2 id="三-DTL语法"><a href="#三-DTL语法" class="headerlink" title="三 DTL语法"></a>三 DTL语法</h2><p>Django模板指的是用Django模板语言（DTL）标记的文本文档(如HTML、XML、CSV等任何文本文档都可以)或者python字符串（文本文档也是由字符组成）。</p><p>DTL的语法主要由四部分构成：变量、过滤器、标签、注释，如下</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base_generic.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;&#123;&#123; section.title &#125;&#125;&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">&#123;#    &lt;h1&gt;hello&lt;/h1&gt; #&#125;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; section.title &#125;&#125;&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &#123;% for story in story_list %&#125;</span><br><span class="line">        &lt;h2&gt;</span><br><span class="line">            &lt;a href=&quot;&#123;&#123; story.get_absolute_url &#125;&#125;&quot;&gt;</span><br><span class="line">                &#123;&#123; story.headline|upper &#125;&#125;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">        &lt;/h2&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123; story.tease|truncatewords:&quot;100&quot; &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><p>让我们来分别作详细介绍</p><h3 id="3-1-DTL之变量"><a href="#3-1-DTL之变量" class="headerlink" title="3.1 DTL之变量"></a>3.1 DTL之变量</h3><h3 id="3-1-1-变量的基本使用"><a href="#3-1-1-变量的基本使用" class="headerlink" title="3.1.1 变量的基本使用"></a>3.1.1 变量的基本使用</h3><p>模板中的变量格式为：。变量名由字母数字和下划线组成，但是不能以下划线开头否则会因为引擎无法解析导致服务端错误。</p><p>如果模板中的数据不是固定死的，而是动态变化的，则必须在html中嵌入变量，如下</p><p>test.html</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; msg &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; dic &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; obj &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; li &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>我们需要在视图函数中为模板test.html的变量名msg、li、dic、obj、obj_li赋值,views.py内容如下</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line">def test(request):</span><br><span class="line">    # 传给模板的变量值可以是任意python类型，如下</span><br><span class="line">    msg=&#x27;hello world&#x27;</span><br><span class="line">    dic=&#123;&#x27;k1&#x27;:1,&#x27;k2&#x27;:2&#125;</span><br><span class="line">    class Person(object):</span><br><span class="line">        def __init__(self,name,age):</span><br><span class="line">            self.name=name</span><br><span class="line">            self.age=age</span><br><span class="line"></span><br><span class="line">    obj=Person(&#x27;allen&#x27;,18)</span><br><span class="line">    li = [1,&#x27;aaa&#x27;,obj]</span><br><span class="line"></span><br><span class="line">    return render(request,&#x27;test.html&#x27;,&#123;&#x27;msg&#x27;:msg,&#x27;dic&#x27;:dic,&#x27;obj&#x27;:obj,&#x27;li&#x27;:li&#125;)</span><br><span class="line">    # 注意：</span><br><span class="line">    # 1、render函数的第三个参数称之为上下文数据，包含了要传给模板的变量值，是一个字典，该字典中的key必须与模板文件中的变量名相对应，render函数会去templates目录下找到模板文件，然后根据字典中的key对应到模板文件中的变量名进行赋值操作，最后将赋值后的模板文件内容返回给浏览器</span><br><span class="line">    # 2、可以将render函数的第三个参数简写为locals(),如下</span><br><span class="line">    return render(request,&#x27;test.html&#x27;,locals()) #locals()会将函数test内定义的名字与值转换为字典中的k与v</span><br></pre></td></tr></table></figure><h3 id="3-1-2-深度查询之句点符的使用"><a href="#3-1-2-深度查询之句点符的使用" class="headerlink" title="3.1.2 深度查询之句点符的使用"></a>3.1.2 深度查询之句点符的使用</h3><p>变量名中不能有空格或者标点符号，但是有一个例外，点(“.”)可以出现在变量中，点后的可以是字典相关（字典的key或者字典内置方法）、对象的属性或方法、数字索引，如下所示</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&#123;# 视图函数参照上例 #&#125;</span><br><span class="line"></span><br><span class="line">&lt;!--调用字符串对象的upper方法，注意不要加括号--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; msg.upper &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--取字典中k1对应的值--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; dic.k1 &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--取对象的name属性--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; obj.name &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--取列表的第2个元素,然后变成大写--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; li.1.upper &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--取列表的第3个元素，并取该元素的age属性--&gt;</span><br><span class="line">&lt;p&gt;&#123;&#123; li.2.age &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>请注意四点</p><p>（1）在渲染页面时，若变量不存在，模板引擎默认用配置项string_if_invalid的值作为替代品，配置如下，默认值为空字符串’’,可以进行配置</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 1、setting.py配置如下</span><br><span class="line">TEMPLATES = [</span><br><span class="line">    # 引擎配置一</span><br><span class="line">    &#123;</span><br><span class="line">        &#x27;NAME&#x27;: &#x27;b1&#x27;,</span><br><span class="line">        &#x27;BACKEND&#x27;: &#x27;django.template.backends.django.DjangoTemplates&#x27;, </span><br><span class="line">        &#x27;DIRS&#x27;: [os.path.join(BASE_DIR, &#x27;aaa&#x27;)],    </span><br><span class="line">        &#x27;APP_DIRS&#x27;: True,</span><br><span class="line">        &#x27;OPTIONS&#x27;: &#123;</span><br><span class="line">            &#x27;string_if_invalid&#x27;:&#x27;allen是大帅比&#x27;,</span><br><span class="line"></span><br><span class="line">            &#x27;context_processors&#x27;: [</span><br><span class="line">                &#x27;django.template.context_processors.debug&#x27;,</span><br><span class="line">                &#x27;django.template.context_processors.request&#x27;,</span><br><span class="line">                &#x27;django.contrib.auth.context_processors.auth&#x27;,</span><br><span class="line">                &#x27;django.contrib.messages.context_processors.messages&#x27;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 2、渲染时针对不存在的变量，值都会被替换成&#x27;allen是大帅比&#x27;</span><br></pre></td></tr></table></figure><p>（2）当点后的值是可调用对象时，模板引擎在渲染时会当做无参函数进行调用，将调用的返回值插入模板。（Django不推荐我们在模板中做过多的逻辑处理，所以模板中的方法调全部为无参调用，即便是遇到有参的需求，那也应该是在后端处理，然后为模板提供处理结果即可）</p><p>（3）约定俗称以下划线开头的变量属性通常被视为私有属性，可能无法访问</p><p>（4）点后值的查找优先级如下</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、先进行：  字典key的查找</span><br><span class="line">2、然后进行：属性或方法的查找</span><br><span class="line">3、最后进行：数字索引的查找</span><br></pre></td></tr></table></figure><p>针对上述优先级，需要尤其注意冲突问题，例如</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def test(request):</span><br><span class="line">    from collections import defaultdict</span><br><span class="line">    msg=&#x27;helloallen&#x27;</span><br><span class="line">    d=defaultdict(int)</span><br><span class="line">    for s in msg:</span><br><span class="line">        d[s]+=1</span><br><span class="line"></span><br><span class="line">    return render(request, &#x27;test.html&#x27;, &#123;&#x27;d&#x27;:d&#125;)</span><br></pre></td></tr></table></figure><p>针对defaultdict字典，在访问某一个不存在的key时会返回一个默认值，这就为冲突埋下了祸根：</p><p>在模板中插入，我们的本意是想调用字典d的方法items()，但实际情况是会首先查找字典的key，所以items会被首先当做key来进行查找，很明显字典d中不存在名为items的key，而针对defaultdict类型的字典，会在key不存在时返回一个默认值（本例返回默认值为0），所以此时并不会调用items()方法。</p><p>针对上述问题的解决方案就是需要在视图中事先将defaultdict转换为dict类型</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d=dict(d)</span><br></pre></td></tr></table></figure><p>然后再传递给模板，这样在渲染时，先去字典中查找键items，无法找到也不会返回任何默认值，所以会转而查找d的属性或方法，从而调用到方法items()</p><h3 id="3-2-DTL之过滤器"><a href="#3-2-DTL之过滤器" class="headerlink" title="3.2 DTL之过滤器"></a>3.2 DTL之过滤器</h3><h3 id="3-2-1-常用过滤器基本使用"><a href="#3-2-1-常用过滤器基本使用" class="headerlink" title="3.2.1 常用过滤器基本使用"></a>3.2.1 常用过滤器基本使用</h3><p>过滤器类似于python的内置函数，用来把变量值加以修饰后再显示，具体语法如下</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#1、</span><br><span class="line">&#123;&#123; 变量名|过滤器名 &#125;&#125;</span><br><span class="line"></span><br><span class="line">#2、链式调用：上一个过滤器的结果继续被下一个过滤器处理</span><br><span class="line">&#123;&#123; 变量名|过滤器1|过滤器2 &#125;&#125;</span><br><span class="line"></span><br><span class="line">#3、有的过滤器取需要参数</span><br><span class="line">&#123;&#123; 变量名|过滤器名:传给过滤器的参数 &#125;&#125;</span><br></pre></td></tr></table></figure><p>常用内置过滤器</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#0、default</span><br><span class="line">#作用：如果一个变量值是False或者为空、None，使用default后指定的默认值，否则，使用变量本身的值，如果value=’‘则输出“nothing”</span><br><span class="line">&#123;&#123; value|default:&quot;nothing&quot; &#125;&#125;</span><br><span class="line"></span><br><span class="line">#1、default_if_none</span><br><span class="line">#作用：如果只针对value是None这一种情况来设置默认值，需要使用default_if_none</span><br><span class="line">#只有在value=None的情况下，才会输出“None...”，</span><br><span class="line">&#123;&#123; value|default_if_none:&quot;None...&quot; &#125;&#125;</span><br><span class="line"></span><br><span class="line">#2、length</span><br><span class="line">#作用：返回值的长度。它对字符串、列表、字典等容器类型都起作用，如果value是 [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]，那么输出是4</span><br><span class="line">&#123;&#123; value|length &#125;&#125;</span><br><span class="line"></span><br><span class="line">#3、filesizeformat</span><br><span class="line">#作用：将值的格式化为一个&quot;人类可读的&quot;文件尺寸(如13KB、4.1 MB、102bytes等等），如果 value 是 12312312321，输出将会是 11.5 GB</span><br><span class="line">&#123;&#123; value|filesizeformat &#125;&#125;</span><br><span class="line"></span><br><span class="line">#4、date</span><br><span class="line">#作用：将日期按照指定的格式输出，如果value=datetime.datetime.now(),按照格式Y-m-d则输出2019-02-02</span><br><span class="line">&#123;&#123; value|date:&quot;Y-m-d&quot; &#125;&#125;　　</span><br><span class="line"></span><br><span class="line">#5、slice</span><br><span class="line">#作用：对输出的字符串进行切片操作，顾头不顾尾,如果value=“allen“，则输出&quot;eg&quot;</span><br><span class="line">&#123;&#123; value|slice:&quot;0:2&quot; &#125;&#125;　</span><br><span class="line"></span><br><span class="line">#6、truncatechars</span><br><span class="line">#作用：如果字符串字符多于指定的字符数量，那么会被截断。截断的字符串将以可翻译的省略号序列（“...”）结尾，如果value=”hello world allen 嘎嘎“，则输出&quot;hello...&quot;,注意8个字符也包含末尾的3个点</span><br><span class="line">&#123;&#123; value|truncatechars:8 &#125;&#125;</span><br><span class="line"></span><br><span class="line">#7、truncatewords</span><br><span class="line">#作用：同truncatechars，但truncatewords是按照单词截断，注意末尾的3个点不算作单词，如果value=”hello world allen 嘎嘎“，则输出&quot;hello world ...&quot;</span><br><span class="line">&#123;&#123; value|truncatewords:2 &#125;&#125;</span><br><span class="line"></span><br><span class="line">#8、default</span><br><span class="line">#作用：如果值为False或者空或者None时，则使用默认值代替</span><br><span class="line">&#123;&#123; value|default:”(N/A)” &#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-2-HTML的自动转义与关闭"><a href="#3-2-2-HTML的自动转义与关闭" class="headerlink" title="3.2.2 HTML的自动转义与关闭"></a>3.2.2 HTML的自动转义与关闭</h3><p>模板在生成HTML时，如果变量中包含一些具有语法意义的特殊字符，则会影响HTML的结果，比如</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, &#123;&#123; name &#125;&#125;</span><br></pre></td></tr></table></figure><p>针对变量，如果用户注册自己的用户名name是一个中规中矩的用户名时，上述代码并无问题，但如果用户恶意注册用户名为下述内容</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 注册时，用户输入自己的用户名就是下述字符</span><br><span class="line">&lt;script&gt;alert(&#x27;hello&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>后台取出name = “alert(‘hello’)”，然后执行render渲染的结果为</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, &lt;script&gt;alert(&#x27;hello&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>上述结果交给浏览器后，意味着浏览器将弹出一个JavaScript警报框！试想，如果是一个博客类网站，恶意作者在自己提交的文章中掺杂了类似上面这种恶意代码，这意味着每个读者在读取他的文章时，自己的浏览器都会弹出一个JavaScript警报框！</p><p>类似的，如果注册的用户名包含’&lt;’号，如下</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;b&gt;allen</span><br></pre></td></tr></table></figure><p>后台取出name = “<strong>allen”，然后执行render渲染的结果为</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello, &lt;b&gt;allen</span><br></pre></td></tr></table></figure><p><strong>上述结果交给浏览器后，有没有对应的闭合标签，意味着其后的内容都会被加粗</strong></p><p><strong>综上，可以确定的是：用户提交的数据不应该被盲目地信任并直接插入到我们的的网页中，因为恶意用户可能会利用这种漏洞来做潜在的坏事。这种类型的安全攻击称为跨站点脚本（XSS，详见：<a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Cross-site_scripting">https://en.wikipedia.org/wiki/Cross-site_scripting</a>）攻击。</strong></p><p><strong>好在django已经为了做了相应的处理：django的模板引擎在生成模板时，默认就会对所有变量的值进行转移，具体是针对变量值中包含的以下五个字符的转义</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 1、使用DTL，以下5种特殊符号默认就会被转义成对应的html命名实体</span><br><span class="line">1、&lt; 被转换成 &amp;lt;</span><br><span class="line">2、&gt; 被转换成 &amp;gt;</span><br><span class="line">3、&#x27; 单引号被转换成 &amp;#x27;</span><br><span class="line">4、&quot; 双引号被转换成 &amp;quot;</span><br><span class="line">5、&amp; 被转换成 &amp;amp;</span><br><span class="line"></span><br><span class="line"># 首先经过转义后得到模板，然后递交给浏览器解析，上述内容均会被当成普通字符输出</span><br><span class="line">例如：</span><br><span class="line">针对value=&quot;&lt;script&gt;alert(123)&lt;/script&gt;&quot;，模板变量&#123;&#123; value &#125;&#125;会被渲染成&amp;lt;script&amp;gt;alert(123)&amp;lt;/script&amp;gt;交给浏览器后会被解析成普通字符”&lt;script&gt;alert(123)&lt;/script&gt;“，失去了js代码的语法意义</span><br></pre></td></tr></table></figure><hr><p><strong>虽然django默认会将所有模板变量进行转义，但有时候我们需要关闭自动转义，比如我们存入数据库的就是一段HTML代码，当我们取出来时就想让浏览器解析其中的语法呈现结果，而不是显示一堆普通字符。那如何关闭自动转义呢？具体操作如下</strong></p><p><strong>（1）针对单个变量-&gt;使用过滤器safe</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; value|safe &#125;&#125;</span><br><span class="line"></span><br><span class="line">比如如value=&#x27;&lt;a href=&quot;https://www.baidu.com&quot;&gt;点我啊&lt;/a&gt;&#x27;，经过过滤器safe的处理，浏览器在进行解析时就会将其当做超链接显示，不加safe过滤器则会当做普通字符显示’&lt;a href=&quot;https://www.baidu.com&quot;&gt;点我啊&lt;/a&gt;‘</span><br></pre></td></tr></table></figure><p><strong>(2）针对模板块-&gt;使用标签autoescape</strong></p><p><strong>autoescape通过参数on和off来控制开启或关闭模板块的整体转义行为，示例如下</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 对包含在标签内的模板块的转义行为进行整体关闭 #&#125;</span><br><span class="line">&#123;% autoescape off %&#125;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        不会转义 &#123;&#123; name &#125;&#125;.</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &#123;#  支持嵌套，设置嵌套的模板块整体开启转义功能 #&#125;</span><br><span class="line">    &#123;% autoescape on %&#125;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            会被转义: &#123;&#123; name &#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &#123;% endautoescape %&#125;</span><br><span class="line">&#123;% endautoescape %&#125;</span><br></pre></td></tr></table></figure><p><strong>autoescape的效果会遗传给子模板（使用标签extends继承当前模板），也会留给引入了当前模板的模板（使用标签include引入当前模板），例如</strong></p><p><strong>base.html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% autoescape on %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">        &#123;% block title %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% block content %&#125;&#123;% endblock %&#125;</span><br><span class="line">&#123;% endautoescape %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>child.html</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 继承父模板base.html #&#125;</span><br><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 定制title块中的内容，其中包含的内容没有特殊字符，转义是否开启没有影响，显示结果均为allen &amp; dsb #&#125;</span><br><span class="line">&#123;% block title %&#125;allen &amp;amp; dsb&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 定制content块中的内容，如果变量name=&quot;&lt;b&gt;allen&lt;/b&gt;&quot;，由于content模板块在父模板中被设置成关闭转义，所以子模板也跟着关闭，生成的值为&lt;b&gt;allen&lt;/b&gt;，交给浏览器后显示结果为加粗的allen  #&#125;</span><br><span class="line">&#123;% block content %&#125;&#123;&#123; name &#125;&#125;&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><p><strong>ps： autoescape的使用涉及到的标签与模板继承的概念，请读者自行查看后续章节</strong></p><p><strong>我们在介绍常用的内置过滤器时提到过：过滤器的参数可以是字符串，比如default过滤器</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; value1|default:&quot;&lt;a href=&#x27;http://www.allenav.com&#x27;&gt;allen草裙舞&lt;/a&gt;&quot; &#125;&#125;</span><br></pre></td></tr></table></figure><p><strong>针对上述代码，我们想要实现的效果是：在value值为Flase/空/None的情况下，会将字符串当成普通字符输出，即浏览器显示出的结果为字面量而不是一个超链接。</strong></p><p><strong>但是，过滤器default并不会对字符串进行转义，所以上述代码在value值为Flase/空/None的情况下，浏览器展示的就是一个超链接，要完成我们的需求，那么在默认值里需要自己将特殊符号写成命名实体，如下</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; value1|default:&quot;&amp;lt;a href=&amp;#x27;http://www.allenav.com&amp;#x27;&amp;gt;allen草裙舞&amp;lt;/a&amp;gt;&quot; &#125;&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>同理，当我们要显示的默认值是“3 &lt; 2”时，即便是按照如下所写，浏览器会显示出“3 &lt; 2”</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; data|default:&quot;3 &lt; 2&quot; &#125;&#125;  &#123;# Bad! Don&#x27;t do this. #&#125;</span><br></pre></td></tr></table></figure><p><strong>，但是我们还是应该写成下面这种格式，这才是通用的书写格式</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; data|default:&quot;3 &amp;lt; 2&quot; &#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-3-其他过滤器（了解）"><a href="#3-2-3-其他过滤器（了解）" class="headerlink" title="3.2.3 其他过滤器（了解）"></a><strong>3.2.3 其他过滤器（了解）</strong></h3><p><strong>详见官网：<a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/3.0/ref/templates/builtins/%23ref-templates-builtins-filters">https://docs.djangoproject.com/en/3.0/ref/templates/builtins/#ref-templates-builtins-filters</a></strong></p><h3 id="3-3-DTL之标签"><a href="#3-3-DTL之标签" class="headerlink" title="3.3 DTL之标签"></a><strong>3.3 DTL之标签</strong></h3><p><strong>相比于模板中的变量，标签更为复杂一些，如</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#1、一些标签用来在输出中创建文本</span><br><span class="line">#2、一些标签用来进行流程控制(执行循环或者if判断)</span><br><span class="line">#3、一些标签用来将外部信息加载到模板中以供以后的变量使用</span><br></pre></td></tr></table></figure><p><strong>模板中的标签的格式为</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 1、</span><br><span class="line">&#123;% 标签名 %&#125;</span><br><span class="line"></span><br><span class="line"># 2、大多数标签都需要接收参数</span><br><span class="line">&#123;% 标签名 参数1 参数2 %&#125;</span><br><span class="line"></span><br><span class="line"># 3、一些标签需要有开始&#123;% tag %&#125;和结束标记&#123;% endtag %&#125;</span><br><span class="line">&#123;% 标签名 %&#125;</span><br><span class="line">...内容...</span><br><span class="line">&#123;% end标签名 %&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-1-常用标签之for标签"><a href="#3-3-1-常用标签之for标签" class="headerlink" title="3.3.1 常用标签之for标签"></a><strong>3.3.1 常用标签之for标签</strong></h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#1、遍历每一个元素：</span><br><span class="line">&#123;% for person in person_list %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; person.name &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">#2、可以利用&#123;% for obj in list reversed %&#125;反向循环。</span><br><span class="line"></span><br><span class="line">#3、遍历一个字典：</span><br><span class="line">&#123;% for key,val in dic.items %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; key &#125;&#125;:&#123;&#123; val &#125;&#125;&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">#4、循环序号可以通过&#123;&#123; forloop &#125;&#125;显示　</span><br><span class="line">forloop.counter            当前循环的索引值（从1开始）</span><br><span class="line">forloop.counter0           当前循环的索引值（从0开始）</span><br><span class="line">forloop.revcounter         当前循环的倒序索引值（从1开始）</span><br><span class="line">forloop.revcounter0        当前循环的倒序索引值（从0开始）</span><br><span class="line">forloop.first              当前循环是第一次循环则返回True，否则返回False</span><br><span class="line">forloop.last               当前循环是最后一次循环则返回True，否则返回False</span><br><span class="line">forloop.parentloop         本层循环的外层循环</span><br><span class="line"></span><br><span class="line">#5、for标签可以带有一个可选的&#123;% empty %&#125; 从句，在变量person_list为空或者没有被找到时，则执行empty子句</span><br><span class="line">&#123;% for person in person_list %&#125;</span><br><span class="line">    &lt;p&gt;&#123;&#123; person.name &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&#123;% empty %&#125;</span><br><span class="line">    &lt;p&gt;sorry,no person here&lt;/p&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p><strong>案列如下</strong></p><p><strong>url.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^test/&#x27;</span>,views.test)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>view.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">request</span>):</span><br><span class="line">    names=[<span class="string">&#x27;allen&#x27;</span>,<span class="string">&#x27;kevin&#x27;</span>]</span><br><span class="line">    dic=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;allen&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="number">18</span>,<span class="string">&#x27;sex&#x27;</span>:<span class="string">&#x27;male&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    list1=[]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;test.html&#x27;</span>,<span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure><p><strong>test.html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">&#123;% for name in names %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; forloop.counter0 &#125;&#125; &#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">输出结果为：</span></span><br><span class="line"><span class="comment">0 allen</span></span><br><span class="line"><span class="comment">1 kevin</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">&#123;% for name in names reversed %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; forloop.revcounter0 &#125;&#125; &#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">输出结果为：</span></span><br><span class="line"><span class="comment">1 kevin</span></span><br><span class="line"><span class="comment">0 allen</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">&#123;% for k,v in dic.items %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; forloop.counter &#125;&#125; &#123;&#123; k &#125;&#125; &#123;&#123; v &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">输出结果为：</span></span><br><span class="line"><span class="comment">1 name allen</span></span><br><span class="line"><span class="comment">2 age 18</span></span><br><span class="line"><span class="comment">3 sex male</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">&#123;% for item in list1 %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>sorry,no value here<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">输出结果为：</span></span><br><span class="line"><span class="comment">sorry,no value here</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-3-2-常用标签之if标签"><a href="#3-3-2-常用标签之if标签" class="headerlink" title="3.3.2 常用标签之if标签"></a><strong>3.3.2 常用标签之if标签</strong></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># 1、注意：</span><br><span class="line">&#123;% if 条件 %&#125;条件为真时if的子句才会生效，条件也可以是一个变量，if会对变量进行求值，在变量值为空、或者视图没有为其传值的情况下均为False</span><br><span class="line"></span><br><span class="line"># 2、具体语法</span><br><span class="line">&#123;% if num &gt; 100 or num &lt; 0 %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>无效<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% elif num &gt; 80 and num &lt; 100 %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>优秀<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>凑活吧<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">#3、if语句支持 and 、or、==、&gt;、&lt;、!=、&lt;=、&gt;=、in、not in、is、is not判断。</span><br><span class="line"></span><br><span class="line">#4、判断条件中可以引入过滤器</span><br><span class="line">&#123;% if athlete_list|length &gt; 1 %&#125;</span><br><span class="line">   Team: &#123;% for athlete in athlete_list %&#125; ... &#123;% endfor %&#125;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">   Athlete: &#123;&#123; athlete_list.0.name &#125;&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">过滤器length返回的数字可用于与数字进行比较，除此之外大多数过滤器返回的都是字符串并不能用于与数字比较</span><br><span class="line"></span><br><span class="line">#5、补充标签firstof</span><br><span class="line">针对下述多分支</span><br><span class="line">    &#123;% if var1 %&#125;</span><br><span class="line">        &#123;&#123; var1 &#125;&#125;</span><br><span class="line">    &#123;% elif var2 %&#125;</span><br><span class="line">        &#123;&#123; var2 &#125;&#125;</span><br><span class="line">    &#123;% elif var3 %&#125;</span><br><span class="line">        &#123;&#123; var3 &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">可以简写为一行</span><br><span class="line">    &#123;% firstof var1 var2 var3 %&#125;</span><br><span class="line"></span><br><span class="line">也可以定义一个备用值，当var1、var2、var3均无值的时使用</span><br><span class="line">&#123;% firstof var1 var2 var3 &quot;fallback value&quot; %&#125;</span><br><span class="line"></span><br><span class="line">还可以使用as语法，将firsof得到的值赋值给一个变量value，以后在模板中使用&#123;&#123; value &#125;&#125;即可</span><br><span class="line">&#123;% firstof var1 var2 var3 &quot;fallback value&quot; as value %&#125;</span><br></pre></td></tr></table></figure><p><strong>案例如下</strong></p><p><strong>urls.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,register_converter,re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 输入http://127.0.0.1:8008/或者http://127.0.0.1:8008/index/都会转发给视图函数index</span></span><br><span class="line">    re_path(<span class="string">r&#x27;^$&#x27;</span>,views.index),</span><br><span class="line">    re_path(<span class="string">r&#x27;^index/$&#x27;</span>,views.index),</span><br><span class="line"></span><br><span class="line">    re_path(<span class="string">r&#x27;^login/&#x27;</span>,views.login),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>views.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    name=request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    pwd=request.POST.get(<span class="string">&#x27;pwd&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&#x27;allen&#x27;</span> <span class="keyword">and</span> pwd == <span class="string">&#x27;123&#x27;</span>:</span><br><span class="line">        current_user=name</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;index.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg=<span class="string">&#x27;账号或密码错误&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;login.html&#x27;</span>,<span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure><p><strong>在templates目录下新建模板文件index.html与login.html</strong></p><p><strong>index.html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">如果用户已经登录，则current_user变量有值，if判断结果为真，会打印变量current_user的值，为当前登录的用户名</span></span><br><span class="line"><span class="comment">如果用户没有登录，则current_user变量无值，if判断结果为假，会打印a标签要求用户先登录</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">&#123;% if current_user %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前登录用户为：&#123;&#123; current_user &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/login/&quot;</span>&gt;</span>请先登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>login.html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--输错账号密码时的提示信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>测试</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver 8008 #在浏览器输入http://127.0.0.1:8008/,然后点击登录，输入账号密码进行验证......</span><br></pre></td></tr></table></figure><h3 id="3-3-3-常用标签之with标签"><a href="#3-3-3-常用标签之with标签" class="headerlink" title="3.3.3 常用标签之with标签"></a><strong>3.3.3 常用标签之with标签</strong></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># with标签用来为一个复杂的变量名起别名,如果变量的值来自于数据库，在起别名后只需要使用别名即可，无需每次都向数据库发送请求来重新获取变量的值</span><br><span class="line">&#123;% with li.1.upper as v %&#125;</span><br><span class="line">    &#123;&#123; v &#125;&#125;</span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-4-常用标签之csrf-token标签"><a href="#3-3-4-常用标签之csrf-token标签" class="headerlink" title="3.3.4 常用标签之csrf_token标签"></a><strong>3.3.4 常用标签之csrf_token标签</strong></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 当用form表单提交POST请求时必须加上标签&#123;% csrf_token%&#125;，该标签用于防止跨站伪造请求</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"># 具体工作原理为：</span><br><span class="line"># 1、在GET请求到form表单时，标签&#123;% csrf_token%&#125;会被渲染成一个隐藏的input标签，该标签包含了由服务端生成的一串随机字符串,如<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrfmiddlewaretoken&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dmje28mFo...OvnZ5&quot;</span>&gt;</span></span><br><span class="line"># 2、在使用form表单提交POST请求时，会提交上述随机字符串，服务端在接收到该POST请求时会对比该随机字符串，对比成功则处理该POST请求，否则拒绝，以此来确定客户端的身份</span><br><span class="line"></span><br><span class="line"># ps：什么是跨站请求伪造（英语：Cross-site request forgery）详见附录2</span><br></pre></td></tr></table></figure><p><strong>更多内置标签与过滤器：<a href="https://link.zhihu.com/?target=https%3A//docs.djangoproject.com/en/3.0/ref/templates/builtins/%23ref-templates-builtins-tags">https://docs.djangoproject.com/en/3.0/ref/templates/builtins/#ref-templates-builtins-tags</a></strong></p><h3 id="3-4-DTL之注释"><a href="#3-4-DTL之注释" class="headerlink" title="3.4 DTL之注释"></a><strong>3.4 DTL之注释</strong></h3><p><strong>单行注释，用注释语法：，在分隔符之间不允许有换行符</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#1、注释一行的某一部分,如下，渲染出的结果只会显示hello</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello&#123;# allen #&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">#2、注释可以包含任何模板代码，如下</span><br><span class="line">&#123;# &#123;% if foo %&#125;bar&#123;% else %&#125; #&#125;</span><br></pre></td></tr></table></figure><p><strong>多行注释，用comment标签，注意：comment标签不能嵌套</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% comment &quot;可以在引号里写好下述代码被注释的原因&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>备注释的内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endcomment %&#125;</span><br></pre></td></tr></table></figure><h2 id="四-模板的导入和继承"><a href="#四-模板的导入和继承" class="headerlink" title="四 模板的导入和继承"></a><strong>四 模板的导入和继承</strong></h2><p><strong>在实际开发中，模板文件彼此之间可能会有大量冗余代码，为此django提供了专门的语法来解决这个问题,主要围绕三种标签的使用：include标签、extends标签、block标签，详解如下</strong></p><h3 id="4-1、模板的导入之include标签"><a href="#4-1、模板的导入之include标签" class="headerlink" title="4.1、模板的导入之include标签"></a><strong>4.1、模板的导入之include标签</strong></h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#作用：在一个模板文件中，引入/重用另外一个模板文件的内容，</span><br><span class="line">&#123;% include &#x27;模版名称&#x27; %&#125;</span><br></pre></td></tr></table></figure><p><strong>案例：</strong></p><p><strong>可以把广告栏写到专门的文件里advertise.html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;adv&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel panel-default&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-heading&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;panel-title&quot;</span>&gt;</span>Panel title<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">            Panel content</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel panel-danger&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-heading&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;panel-title&quot;</span>&gt;</span>Panel title<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">            Panel content</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel panel-warning&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-heading&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;panel-title&quot;</span>&gt;</span>Panel title<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">            Panel content</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>然后在base.html文件中用include标签引入advertise.html文件的内容</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">integrity</span>=<span class="string">&quot;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        * &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.header</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: black;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--在base.html引入advertise.html文件的内容--&gt;</span></span><br><span class="line">            &#123;% include &quot;advertise.html&quot; %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-2、模板的继承-派生之extends标签、block标签"><a href="#4-2、模板的继承-派生之extends标签、block标签" class="headerlink" title="4.2、模板的继承\派生之extends标签、block标签"></a><strong>4.2、模板的继承\派生之extends标签、block标签</strong></h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#作用：在一个模板文件中，引入/重用另外一个模板文件的内容</span><br><span class="line">&#123;% extends &quot;模版名称&quot; %&#125;</span><br><span class="line">#  也就是说include有的功能extends全都有，但是extends可以搭配一个block标签，用于在继承的基础上定制新的内容</span><br></pre></td></tr></table></figure><p><strong>案例</strong></p><p><strong>Django模版引擎中最复杂且最强大的部分就是模版继承了。我们以先创建一个基本的“骨架”模版，它包含我们站点中的全部元素，并且可以定义多处blocks ，例如我们创建base.html内容如下</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">        &#123;% block title %&#125;自定义title名&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">integrity</span>=<span class="string">&quot;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        * &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.header</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#919191</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span><br><span class="line">                &#123;% block sidebar %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item active&quot;</span>&gt;</span>服装城<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span>美妆馆<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span>超市<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span>全球购<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span>闪购<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span>团购<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span></span><br><span class="line">            &#123;% block content %&#125;</span><br><span class="line">                base.html页面内容</span><br><span class="line">            &#123;% endblock %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>模板base.html 定义了一个可以用于两列排版页面的简单HTML骨架。我们新建子模板index.html的主要工作就是继承base.html然后填充/覆盖其内部的blocks。</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!--用新内容完全覆盖了父模板内容--&gt;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">    index页面</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% block sidebar %&#125;</span><br><span class="line">    &lt;!--该变量会将父模板中sidebar中原来的内容继承过来，然后我们可以在此基础上新增，否则就是纯粹地覆盖--&gt;</span><br><span class="line">    &#123;&#123; block.super &#125;&#125;</span><br><span class="line"></span><br><span class="line">    &lt;!--在继承父模板内容的基础上新增的标签--&gt;</span><br><span class="line">    &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;拍卖&lt;/a&gt;</span><br><span class="line">    &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;金融&lt;/a&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;!--用新内容完全覆盖了父模板内容--&gt;</span><br><span class="line">    &lt;p&gt;index页面内容&lt;/p&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure><hr><p><strong>我们通过django访问index.html看到内容如下(block标签的内容都完成了替换或更新)</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;</span><br><span class="line">        index页面</span><br><span class="line">    &lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;</span><br><span class="line">          integrity=&quot;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&quot; crossorigin=&quot;anonymous&quot;&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        * &#123;</span><br><span class="line">            margin: 0;</span><br><span class="line">            padding: 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .header &#123;</span><br><span class="line">            height: 50px;</span><br><span class="line">            width: 100%;</span><br><span class="line">            background-color: #919191;</span><br><span class="line">            margin-bottom: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;header&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;col-md-3&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;list-group&quot;&gt;</span><br><span class="line">                &lt;!--基于&#123;&#123; block.super &#125;&#125;继承自父模板中的内容--&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;list-group-item active&quot;&gt;服装城&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;美妆馆&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;超市&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;全球购&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;闪购&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;团购&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &lt;!--在继承父模板内容的基础上新增的标签--&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;拍卖&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;list-group-item&quot;&gt;金融&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;col-md-9&quot;&gt;</span><br><span class="line">            &lt;!--用新内容完全覆盖了父模板内容--&gt;</span><br><span class="line">            &lt;p&gt;index页面内容&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>我们可以根据需要使用尽可能多的继承级别，使用继承的一种常见方式是分成三个级别</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、创建一个base.html用来保存站点的主要外观</span><br><span class="line">2、为站点的每个部分创建一个base_SECTIONNAME.html模板。例如，base_news.html、base_sports.html。这些模板都继承自base.html并包含每部分特定的样式/设计。</span><br><span class="line">3、为每种类型的页面创建单独的模板，如新闻文章或博客条目。这些继承自2中的对应的模板。</span><br></pre></td></tr></table></figure><p><strong>总结与注意：</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#1、include仅仅只是完全引用其他模板文件，而extends却可以搭配block在引用的基础上进行扩写</span><br><span class="line"></span><br><span class="line">#2、如果使用模板继承，那么子模板必须将标签&#123;% extends %&#125;放在首行，否则模板继承无效。</span><br><span class="line"></span><br><span class="line">#3、base.html中&#123;% block %&#125;标记越多，它的可定制性就越强。子模板不必将父模板中定义的&#123;% block %&#125;全部重新定义一遍，你只需要定义自己需要的即可，未定义的&#123;% block %&#125;会继承父模板的内容</span><br><span class="line"></span><br><span class="line">#4、如果你发现在多个模板中存在重复的内容，我们应该将其放入父模板中</span><br><span class="line"></span><br><span class="line">#5、变量&#123;&#123; block.super &#125;&#125; 可以重用父类的内容，然后在父类基础上增加新内容，而不是完全覆盖。使用&#123;&#123;block.super&#125;插入的数据将不会自动转义，因为它已在父模板中转义（如果需要）。</span><br><span class="line"></span><br><span class="line">#6、为了提升可读性，我们可以给标签&#123;% endblock %&#125; 起一个名字 。例如：</span><br><span class="line">    &#123;% block content %&#125;</span><br><span class="line">    ...</span><br><span class="line">    &#123;% endblock content %&#125;　</span><br><span class="line"></span><br><span class="line">#7、在一个模版中不能出现重名的block标签。</span><br></pre></td></tr></table></figure><h2 id="五-自定义过滤器和标签"><a href="#五-自定义过滤器和标签" class="headerlink" title="五 自定义过滤器和标签"></a><strong>五 自定义过滤器和标签</strong></h2><h3 id="5-1-自定义过滤器和标签"><a href="#5-1-自定义过滤器和标签" class="headerlink" title="5.1 自定义过滤器和标签"></a><strong>5.1 自定义过滤器和标签</strong></h3><p><strong>当内置的过滤器或标签无法满足我们需求时，我们可以自定义，具体操作步骤如下</strong></p><p><strong>1、在settings中的INSTALLED_APPS添加当前app的名字，不然django无法找到自定义的过滤器或标签</strong></p><p><strong>settings.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在settings.py中找到该列表，然后加以配置</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app01.apps.App01Config&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app01&#x27;</span>, <span class="comment"># 添加当前app的名字</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>2、在文件夹app01下创建包templatetags</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、templatetags目录下需要有__init__.py文件，确保它是一个python的包</span><br><span class="line">2、文件夹名只能是templatetags</span><br><span class="line">3、templatetags与models.py，views.py在同一级别</span><br></pre></td></tr></table></figure><p><strong>3、在templatetags新建任意.py文件，如my_tags.py，在该文件中自定义过滤器或标签，由于我们后期是要通过加载文件来引入自定义的过滤器或标签，所以请保障文件名的唯一性，如此方可保障多个app之间不相互冲突</strong></p><p><strong>目录层级如下</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app01/</span><br><span class="line">    __init__.py</span><br><span class="line">    models.py</span><br><span class="line">    templatetags/</span><br><span class="line">        __init__.py</span><br><span class="line">        my_tags.py</span><br><span class="line">    views.py</span><br><span class="line"></span><br><span class="line"># 加载方式：&#123;% load 自定义标签或过滤器所处的文件名字 %&#125;,本例对应为&#123;% load my_tags %&#125;</span><br></pre></td></tr></table></figure><p><strong>my_tags.py文件内容如下</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一、必须首先在模板顶级定义一个变量register，该变量值为template.Library的实例</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line"></span><br><span class="line">register = template.Library() <span class="comment"># 注意变量名必须为register,不可改变</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#二、然后再开始自定义过滤器与标签</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2.1、自定义过滤器</span></span><br><span class="line"><span class="string">    自定义过滤器是一个python函数，该函数需要1或2个参数，两个参数会一同传入</span></span><br><span class="line"><span class="string">    (1) 第一个参数来自过滤器左侧的变量(固定有)</span></span><br><span class="line"><span class="string">    (2) 第二个参数来自过滤右侧的参数值(可有可无)</span></span><br><span class="line"><span class="string">    例如：针对自定义过滤器foo的使用</span></span><br><span class="line"><span class="string">    &#123;&#123; var|foo:&quot;bar&quot; &#125;&#125;，会执行foo(var,&quot;bar&quot;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@register.filter(<span class="params">name=<span class="string">&#x27;cut&#x27;</span></span>) </span><span class="comment"># name参数用来命名自定义过滤器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cut</span>(<span class="params">value, arg</span>): <span class="comment"># 有两个参数</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Removes all values of arg from the given string&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> value.replace(arg, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@register.filter </span><span class="comment"># 省略name参数，过滤器名字默认为函数名</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lower</span>(<span class="params">value</span>): <span class="comment"># 只有一个参数</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Converts a string into all lowercase&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> value.lower()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.2、自定义标签：可以定义多个参数</span></span><br><span class="line"><span class="meta">@register.simple_tag</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_multi_tag</span>(<span class="params">v1, v2</span>): </span><br><span class="line">    <span class="keyword">return</span> v1 * v2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2.3、自定义标签扩展之mark_safe</span></span><br><span class="line"><span class="string">    我们可以用内置标签safe来关闭转义，从而让标签内容有语法意义，但如果我们想让自定义标签处理的结果也有语法意义，则不能使用内置标签safe了，需要使用mark_safe，可以实现与内置标签safe同样的功能</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"></span><br><span class="line"><span class="meta">@register.simple_tag</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_input_tag</span>(<span class="params"><span class="built_in">id</span>, name</span>):</span><br><span class="line">    res = <span class="string">&quot;&lt;input type=&#x27;text&#x27; id=&#x27;%s&#x27; name=&#x27;%s&#x27; /&gt;&quot;</span> % (<span class="built_in">id</span>, name)</span><br><span class="line">    <span class="keyword">return</span> mark_safe(res)</span><br></pre></td></tr></table></figure><p><strong>4、自定义过滤器或标签必须重新启动django方可生效</strong></p><h3 id="5-2-自定义过滤器和标签的使用"><a href="#5-2-自定义过滤器和标签的使用" class="headerlink" title="5.2 自定义过滤器和标签的使用"></a><strong>5.2 自定义过滤器和标签的使用</strong></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--必须先加载存有自定义过滤器和标签的文件--&gt;</span></span><br><span class="line">&#123;% load my_tags %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--过滤器cut使用：处理结果为：allen is 18 years old--&gt;</span></span><br><span class="line">&#123;&#123; &#x27;allen is 180 years old&#x27;|cut:&quot;0&quot; &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--过滤器lower使用：处理结果为：allen--&gt;</span></span><br><span class="line">&#123;&#123; &#x27;allen&#x27;|lower &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--结果为2--&gt;</span></span><br><span class="line">&#123;% my_multi_tag 1 2 %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">结果为一个input标签，该表的属性id=&quot;inp1&quot; name=&quot;username&quot;</span></span><br><span class="line"><span class="comment">注意：input的属性值均为字符串类型，所以my_input_tag后的两个值均为字符串类型</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">&#123;% my_input_tag &quot;inp1&quot; &quot;username&quot; %&#125; </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>对比自定义标签与自定义过滤器</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#1、自定义过滤器只能传两个参数，而自定义标签却可以传多个参数</span><br><span class="line"></span><br><span class="line">#2、过滤器可以用于if判断，而标签不能</span><br><span class="line">&#123;% if salary|my_multi_filter:12 &gt; 200 %&#125;</span><br><span class="line">    &lt;p&gt;优秀&lt;/p&gt;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    &lt;p&gt;垃圾&lt;/p&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p><strong>### 5.3 Inclusion tags</strong></p><p><strong>在4.1小节我们提及内置的include标签可以在当前模板中引入其他的模板，但有一个问题是：被引入的模板内容是固定死的，如果我们想根据传入不同的参数控制被引入模板的内容，就需要自定义inclusion标签。</strong></p><p><strong>先创建好被引入的模板userinfo.html,嵌入变量</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>靓仔的名字: &#123;&#123; username &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>靓仔的年龄: &#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>然后自定义inclusion标签</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my_tags.py，其余准备工作请读者自行参考自定义标签，此处我们直接上代码</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line"></span><br><span class="line">register = template.Library()</span><br><span class="line"></span><br><span class="line"><span class="meta">@register.inclusion_tag(<span class="params"><span class="string">&#x27;userinfo.html&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_userinfo</span>(<span class="params">username, age</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    可以函数内编写一系列的逻辑，比如根据传来的参数，去后台数据库中取出相应的数据</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    res = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: age,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p><strong>自定义标签get_userinfo的返回值必须是一个字典，该字典用来渲染模板userinfo.html。</strong></p><p><strong>如果我们想在index.html中引入userinfo.html的内容，做法如下，为标签get_userinfo传入不同的参数则会得到不同的模板内容</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% load my_tags %&#125;</span><br><span class="line">&#123;% get_userinfo &quot;allen&quot; age=18 %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>自定义inclusion标签函数可以接收任意数量的位置或关键字参数，例如</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@register.inclusion_tag(&#x27;my_template.html&#x27;)</span><br><span class="line">def my_inclusion_tag(a, b, *args, **kwargs):</span><br><span class="line">    warning = kwargs[&#x27;warning&#x27;]</span><br><span class="line">    profile = kwargs[&#x27;profile&#x27;]</span><br><span class="line">    ...</span><br><span class="line">    return 用于渲染模板&#x27;my_template.html&#x27;的字典</span><br></pre></td></tr></table></figure><p><strong>但此时的参数都需要在模板中直接传递，比如</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% my_inclusion_tag &quot;allen&quot; 18 book.title warning=message|lower profile=user.profile %&#125;</span><br></pre></td></tr></table></figure><p><strong>毫无疑问，让模板的开发者去记住所有参数的顺序并进行传递是非常痛苦的，为此register.inclusion_tag提供了一个参数takes_context专门用来解决这个问题。该参数默认值为False，当设置成True时，就像单词字面所表达的一样：从contex中获取参数。context是由当前模板对应的视图返回的，如当前模板时index.html，那context就来自于index.html对应的后台视图返回。所以当takes_context=True时，自定义标签只需有一个参数，且参数名必须为context，与render函数的context参数相呼应</strong></p><p><strong>my_template.html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;&#123; aaa &#125;&#125;</span><br><span class="line">&#123;&#123; bbb &#125;&#125;</span><br><span class="line">&#123;&#123; ccc &#125;&#125;</span><br><span class="line">&#123;&#123; ddd &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>my_tags.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line"></span><br><span class="line">register = template.Library()  <span class="comment"># 注意变量名必须为register,不可改变</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@register.inclusion_tag(<span class="params"><span class="string">&#x27;my_template.html&#x27;</span>, takes_context=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_inclusion_tag</span>(<span class="params">context</span>):</span><br><span class="line"></span><br><span class="line">    res = &#123;</span><br><span class="line">        <span class="string">&#x27;aaa&#x27;</span>: context[<span class="string">&#x27;a&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;bbb&#x27;</span>: context[<span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;ccc&#x27;</span>: context[<span class="string">&#x27;warning&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;ddd&#x27;</span>: context[<span class="string">&#x27;profile&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;other_data&#x27;</span>:<span class="string">&#x27;...&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res <span class="comment"># 该字典是用来渲染模板&#x27;my_template.html&#x27;的，不要与context混淆</span></span><br></pre></td></tr></table></figure><p><strong>如果我们想在index.html中引入my_template.html的内容，做法如下，此时无需为标签my_inclusion_tag传入参数</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% load my_tags %&#125;</span><br><span class="line">&#123;% my_inclusion_tag %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>my_inclusion_tag的参数是来自于当前模板(即index.html)对应的后台视图返回的context</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 该字典与标签my_inclusion_tag的参数context呼应</span></span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">&#x27;a&#x27;</span>: <span class="string">&quot;allen&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;b&#x27;</span>: <span class="number">18</span>,</span><br><span class="line">        <span class="string">&#x27;warning&#x27;</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;profile&#x27;</span>: <span class="string">&#x27;yyy&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;index.html&#x27;</span>, context=context)</span><br></pre></td></tr></table></figure><h2 id="六-静态文件配置"><a href="#六-静态文件配置" class="headerlink" title="六 静态文件配置"></a><strong>六 静态文件配置</strong></h2><h3 id="6-1-单app下静态文件的组织与使用"><a href="#6-1-单app下静态文件的组织与使用" class="headerlink" title="6.1 单app下静态文件的组织与使用"></a><strong>6.1 单app下静态文件的组织与使用</strong></h3><p><strong>我们在编写模板文件时，需要大量引用css、js、图片等静态文件，如果我们将这些文件在服务端存放的路径都固定写死那么将非常不利于后期的扩展，我们可以这么做</strong></p><p><strong>1、settings.py</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = &#x27;/static/&#x27; # 找到这一行，然后新增下述代码</span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, &#x27;statics&#x27;),# 获取静态文件在服务端的绝对路径</span><br><span class="line">]</span><br><span class="line">#STATIC_URL = &#x27;/static/&#x27;就是为静态文件的绝对路径起了一个别名，以后我们只需要用路径/static/即可</span><br></pre></td></tr></table></figure><p><strong>2、在项目根目录下新增文件夹statics，为了更便于管理，可以在statics下新建子文件夹css、js、img等</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># statics目录结构</span><br><span class="line">statics</span><br><span class="line">├── css</span><br><span class="line">│   └── my.css</span><br><span class="line">├── img</span><br><span class="line">│   └── rr.jpeg</span><br><span class="line">└── js</span><br><span class="line">    ├── jquery-3.6.1.min.js</span><br><span class="line">    └── my.js</span><br></pre></td></tr></table></figure><p><strong>3、新建模板文件index.html,在该文件中对静态文件的引用如下</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/css/my.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>我是红色的，点我就绿<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/rb.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/jquery-3.3.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/my.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>综上，在配置完settings.py后，所有的静态文件路径都可以采用别名/static/作为起始，这在一定程度上会有利于程序的扩展性，但如果我们在项目后期维护时，连/static/这个值也需要修改，那意味着所有模板文件中也都需要跟着改了，扩展性依然很差，为此，django在一个名为static.py的文件中定义了标签static、get_static_prefix，二者都可以解决该问题</strong></p><p><strong>test.html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注意：必须先加载文件static.py--&gt;</span></span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    <span class="comment">&lt;!--注意：此处的static是一个定义在static.py中的一个标签，名字与文件名一样而已，不要搞混--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;css/my.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>我是红色的，点我就绿<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;img/rb.jpeg&#x27; %&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;js/jquery-3.3.1.min.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;js/my.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>标签static会接收传入的参数，然后这根据<code>settings.py</code>中变量<code>STATIC_URL</code>的值拼接出一个完整的路径，如果<code>STATIC_URL = &#39;/static/&#39;</code>，那么<code>href=&quot;&#123;% static 'css/my.css' %&#125;&quot;</code>会被渲染成<code>href=&quot;/static/css/my.css&quot;</code>，如果<code>STATIC_URL = &#39;/static123/&#39;</code>，那么<code>href=&quot;&#123;% static 'css/my.css' %&#125;&quot;</code>会被渲染成<code>href=&quot;/static123/css/my.css&quot;</code>。</p><p><strong>标签get_static_prefix也可以完成同样的效果，只不过用法不同。我们不能为标签get_static_prefix传参，因为标签get_static_prefix代表的只是settings.py中STATIC_URL的值，所以我们需要做的是在get_static_prefix的基础上自行拼接路径，如下</strong></p><p><strong>test.html</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注意：同样需要先加载文件static.py--&gt;</span></span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    <span class="comment">&lt;!--使用标签get_static_prefix拼接路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% get_static_prefix %&#125;css/my.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>我是红色的，点我就绿<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% get_static_prefix %&#125;img/rb.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% get_static_prefix %&#125;js/jquery-3.3.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% get_static_prefix %&#125;js/my.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>如果<code>STATIC_URL = &#39;/static/&#39;</code>，那么<code>href=&quot;&#123;% get_static_prefix %&#125;css/my.css&quot;</code>会被渲染成<code>href=&quot;/static/css/my.css&quot;</code>，其它同理</strong></p><h3 id="6-2-多app下静态文件的组织与使用"><a href="#6-2-多app下静态文件的组织与使用" class="headerlink" title="6.2 多app下静态文件的组织与使用"></a><strong>6.2 多app下静态文件的组织与使用</strong></h3><p><strong>静态文件的查找与模板的查找是一致的，当我们有多个app时，可以如下组织目录结构(只列举了静态文件相关目录)</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/Users/linhaifeng/PycharmProjects/allenPro</span><br><span class="line">├── app01</span><br><span class="line">│   ├── static</span><br><span class="line">│   │   └── a.css # 文件内容为：h1 &#123; color: red; &#125;</span><br><span class="line">├── app02</span><br><span class="line">│   ├── static</span><br><span class="line">│   │   └── a.css # 文件内容为：h1 &#123; color: green; &#125;</span><br><span class="line">├── static</span><br><span class="line">│   └── a.css     # 文件内容为：h1 &#123; color: blue; &#125;</span><br><span class="line">├── static1</span><br><span class="line">│   └── a.css     # 文件内容为：h1 &#123; color: goldenrod; &#125;</span><br><span class="line">├── templates</span><br><span class="line">│   └── index.html</span><br></pre></td></tr></table></figure><p><strong>配置文件settings.py</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = &#x27;/static/&#x27;</span><br><span class="line"></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, &quot;static&quot;),</span><br><span class="line">    os.path.join(BASE_DIR, &quot;static1&quot;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>在模板index.html中,</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &quot;</span><span class="attr">a.css</span>&quot; %&#125;&quot;&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>模板内容<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>静态文件的加载优先级模板的查找优先级是一样的原理，<code>&#123;% static "a.css" %&#125;</code>查找优先级为</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、djanog首先会先依次检索STATICFILES_DIRS列表中的目录</span><br><span class="line">2、然后按照配置项INSTALLED_APPS注册的app顺序，依次检索每个app下的static目录</span><br></pre></td></tr></table></figure><p><strong>为了避免出现冲突，与模板的组织原理一样，我们可以在每个static下创建子目录来充当名称空间的作用，所以上述目录结构调整为</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/Users/linhaifeng/PycharmProjects/allenPro</span><br><span class="line">├── app01</span><br><span class="line">│   ├── static</span><br><span class="line">│   │   └── app01</span><br><span class="line">│   │       └── a.css</span><br><span class="line">├── app02</span><br><span class="line">│   ├── static</span><br><span class="line">│   │   └── app02</span><br><span class="line">│   │       └── a.css</span><br><span class="line">├── static</span><br><span class="line">│   └── base</span><br><span class="line">│       └── a.css</span><br><span class="line">├── static1</span><br><span class="line">│   └── base1</span><br><span class="line">│       └── a.css</span><br><span class="line">├── templates</span><br><span class="line">│   └── index.html</span><br></pre></td></tr></table></figure><p><strong>模板index.html中引入静态文件a.css的路径如下，即便静态文件重名，也不会发生冲突</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &quot;</span><span class="attr">base</span>/<span class="attr">a.css</span>&quot; %&#125;&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &quot;</span><span class="attr">base1</span>/<span class="attr">a.css</span>&quot; %&#125;&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &quot;</span><span class="attr">app01</span>/<span class="attr">a.css</span>&quot; %&#125;&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &quot;</span><span class="attr">app02</span>/<span class="attr">a.css</span>&quot; %&#125;&quot;&gt;</span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://jerrrywang.github.io">JerryWang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://jerrrywang.github.io/2021/11/05/Python/Django/Django%E4%B9%8B%E6%97%85/4.Django%E4%B9%8B%E6%A8%A1%E7%89%88%E5%B1%82/">https://jerrrywang.github.io/2021/11/05/Python/Django/Django之旅/4.Django之模版层/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jerrrywang.github.io" target="_blank">JerryWang</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="social-share" data-image="https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/08/Python/Django/Django%E4%B9%8B%E6%97%85/5.ORM%E4%B9%8B%E5%88%9D%E8%AF%86/"><img class="prev-cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ORM初识</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/03/Python/Django/Django%E4%B9%8B%E6%97%85/3.Django%E4%B9%8B%E8%A7%86%E5%9B%BE%E5%B1%82/"><img class="next-cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_2.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Django之视图层</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/11/01/Python/Django/Django%E4%B9%8B%E6%97%85/1.Web%E6%A1%86%E6%9E%B6%E4%B8%8EDjango%E7%AE%80%E4%BB%8B/" title="web应用"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-01</div><div class="title">web应用</div></div></a></div><div><a href="/2021/11/22/Python/Django/Django%E4%B9%8B%E6%97%85/10.%E4%B8%AD%E9%97%B4%E4%BB%B6/" title="中间件"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-22</div><div class="title">中间件</div></div></a></div><div><a href="/2021/11/23/Python/Django/Django%E4%B9%8B%E6%97%85/11.celery/" title="celery"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-23</div><div class="title">celery</div></div></a></div><div><a href="/2021/11/25/Python/Django/Django%E4%B9%8B%E6%97%85/12.HayStack%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2/" title="HayStack全文检索"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-25</div><div class="title">HayStack全文检索</div></div></a></div><div><a href="/2021/11/26/Python/Django/Django%E4%B9%8B%E6%97%85/13.%E7%BC%93%E5%AD%98/" title="缓存"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_5.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-26</div><div class="title">缓存</div></div></a></div><div><a href="/2021/11/27/Python/Django/Django%E4%B9%8B%E6%97%85/14%E4%BF%A1%E5%8F%B7/" title="信号"><img class="cover" src="https://jerrrywang.github.io/2018/10/11/photo/ming_1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-27</div><div class="title">信号</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC80NTg2Ni8yMjM3Nw"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">JerryWang</div><div class="author-info__description">再牛逼的梦想，也抵不过傻逼一样的坚持！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">155</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">90</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><a id="card-info-btn" href="https://jerrrywang.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/JerrryWang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wjy_0316@126.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://weibo.com/allenaq/" target="_blank" title="WeiBo"><i class="fab fa-zhihu"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;低级的欲望,放纵即可获得<br>-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;高级的欲望,克制才能得到</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E6%A8%A1%E6%9D%BF%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">一 模板简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">二 模板的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%A0%87%E5%87%86API"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 标准API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 模板引擎配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-DTL%E8%AF%AD%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">三 DTL语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-DTL%E4%B9%8B%E5%8F%98%E9%87%8F"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 DTL之变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%8F%98%E9%87%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">3.1.1 变量的基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E6%B7%B1%E5%BA%A6%E6%9F%A5%E8%AF%A2%E4%B9%8B%E5%8F%A5%E7%82%B9%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">3.1.2 深度查询之句点符的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-DTL%E4%B9%8B%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">3.4.</span> <span class="toc-text">3.2 DTL之过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%B8%B8%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.</span> <span class="toc-text">3.2.1 常用过滤器基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-HTML%E7%9A%84%E8%87%AA%E5%8A%A8%E8%BD%AC%E4%B9%89%E4%B8%8E%E5%85%B3%E9%97%AD"><span class="toc-number">3.6.</span> <span class="toc-text">3.2.2 HTML的自动转义与关闭</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-%E5%85%B6%E4%BB%96%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-number">3.7.</span> <span class="toc-text">3.2.3 其他过滤器（了解）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-DTL%E4%B9%8B%E6%A0%87%E7%AD%BE"><span class="toc-number">3.8.</span> <span class="toc-text">3.3 DTL之标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE%E4%B9%8Bfor%E6%A0%87%E7%AD%BE"><span class="toc-number">3.9.</span> <span class="toc-text">3.3.1 常用标签之for标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE%E4%B9%8Bif%E6%A0%87%E7%AD%BE"><span class="toc-number">3.10.</span> <span class="toc-text">3.3.2 常用标签之if标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE%E4%B9%8Bwith%E6%A0%87%E7%AD%BE"><span class="toc-number">3.11.</span> <span class="toc-text">3.3.3 常用标签之with标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-4-%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE%E4%B9%8Bcsrf-token%E6%A0%87%E7%AD%BE"><span class="toc-number">3.12.</span> <span class="toc-text">3.3.4 常用标签之csrf_token标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-DTL%E4%B9%8B%E6%B3%A8%E9%87%8A"><span class="toc-number">3.13.</span> <span class="toc-text">3.4 DTL之注释</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%AF%BC%E5%85%A5%E5%92%8C%E7%BB%A7%E6%89%BF"><span class="toc-number">4.</span> <span class="toc-text">四 模板的导入和继承</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%AF%BC%E5%85%A5%E4%B9%8Binclude%E6%A0%87%E7%AD%BE"><span class="toc-number">4.1.</span> <span class="toc-text">4.1、模板的导入之include标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%BB%A7%E6%89%BF-%E6%B4%BE%E7%94%9F%E4%B9%8Bextends%E6%A0%87%E7%AD%BE%E3%80%81block%E6%A0%87%E7%AD%BE"><span class="toc-number">4.2.</span> <span class="toc-text">4.2、模板的继承\派生之extends标签、block标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E6%A0%87%E7%AD%BE"><span class="toc-number">5.</span> <span class="toc-text">五 自定义过滤器和标签</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E6%A0%87%E7%AD%BE"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 自定义过滤器和标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 自定义过滤器和标签的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">6.</span> <span class="toc-text">六 静态文件配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%8D%95app%E4%B8%8B%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E7%BB%84%E7%BB%87%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 单app下静态文件的组织与使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%A4%9Aapp%E4%B8%8B%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E7%BB%84%E7%BB%87%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 多app下静态文件的组织与使用</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/07/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E9%80%9A%E8%BF%87%20SSH%20%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%9C%AC%E5%9C%B0%20Shell%20%E8%84%9A%E6%9C%AC/" title="通过 SSH 链接服务器运行本地 Shell 脚本"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_6.jpeg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="通过 SSH 链接服务器运行本地 Shell 脚本"></a><div class="content"><a class="title" href="/2022/11/07/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E9%80%9A%E8%BF%87%20SSH%20%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%9C%AC%E5%9C%B0%20Shell%20%E8%84%9A%E6%9C%AC/" title="通过 SSH 链接服务器运行本地 Shell 脚本">通过 SSH 链接服务器运行本地 Shell 脚本</a><time datetime="2022-11-07T04:35:30.000Z" title="发表于 2022-11-07 12:35:30">2022-11-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/13/Python/%E6%A8%A1%E5%9D%97/loguru%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" title="loguru日志模块的使用"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_0.jpeg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="loguru日志模块的使用"></a><div class="content"><a class="title" href="/2022/07/13/Python/%E6%A8%A1%E5%9D%97/loguru%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" title="loguru日志模块的使用">loguru日志模块的使用</a><time datetime="2022-07-13T01:10:19.000Z" title="发表于 2022-07-13 09:10:19">2022-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/13/Python/%E6%A8%A1%E5%9D%97/tarfile%E6%A8%A1%E5%9D%97/" title="tarfile压缩模块的使用"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_10.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="tarfile压缩模块的使用"></a><div class="content"><a class="title" href="/2022/07/13/Python/%E6%A8%A1%E5%9D%97/tarfile%E6%A8%A1%E5%9D%97/" title="tarfile压缩模块的使用">tarfile压缩模块的使用</a><time datetime="2022-07-13T01:10:19.000Z" title="发表于 2022-07-13 09:10:19">2022-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/12/Python/%E6%A8%A1%E5%9D%97/python%E7%BB%99%E5%9B%BE%E7%89%87%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E6%B0%B4%E5%8D%B0filestools%E6%A8%A1%E5%9D%97/" title="python给图片批量添加水印filestools模块"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_8.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="python给图片批量添加水印filestools模块"></a><div class="content"><a class="title" href="/2022/07/12/Python/%E6%A8%A1%E5%9D%97/python%E7%BB%99%E5%9B%BE%E7%89%87%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E6%B0%B4%E5%8D%B0filestools%E6%A8%A1%E5%9D%97/" title="python给图片批量添加水印filestools模块">python给图片批量添加水印filestools模块</a><time datetime="2022-07-12T01:00:19.000Z" title="发表于 2022-07-12 09:00:19">2022-07-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/18/Python/%E6%A8%A1%E5%9D%97/python%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6filestools%E3%80%81glob%E6%A8%A1%E5%9D%97/" title="python查找文件fnmatch、glob模块"><img src="https://jerrrywang.github.io/2018/10/11/photo/ming_7.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="python查找文件fnmatch、glob模块"></a><div class="content"><a class="title" href="/2022/06/18/Python/%E6%A8%A1%E5%9D%97/python%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6filestools%E3%80%81glob%E6%A8%A1%E5%9D%97/" title="python查找文件fnmatch、glob模块">python查找文件fnmatch、glob模块</a><time datetime="2022-06-18T01:00:19.000Z" title="发表于 2022-06-18 09:00:19">2022-06-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By JerryWang</div><div class="footer_custom_text"><a href="https://jerrrywang.github.io">生活要像水墨画一样的浓厚多姿</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){GLOBAL_CONFIG_SITE.isPost&&panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><script>function loadLivere(){var e,t,o,r;"object"==typeof LivereTower?window.LivereTower.init():(e=document,t="script",r=e.getElementsByTagName(t)[0],"function"!=typeof LivereTower&&((o=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",o.async=!0,r.parentNode.insertBefore(o,r)))}{function loadOtherComment(){loadLivere()}loadLivere()}</script></div><div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-order="random"></div><script id="canvas_nest" defer color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU,JerryWang,超帥,富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),"object"==typeof preloader&&preloader.initLoading(),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>var font="Ringing"</script><script data-pjax>function electric_clock_injector_config(){var c=document.getElementsByClassName("sticky_layout")[0];console.log("已挂载electric_clock"),c.insertAdjacentHTML("afterbegin",'<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://jerrrywang.github.io/api/shubiao/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&(location.pathname,1)&&electric_clock_injector_config()</script><script src="https://jerrrywang.github.io/api/jquery.min.js"></script><script>loc=$.ajax({url:"https://ipapi.co/json/",type:"GET",dataType:"json",async:!1,success:function(e){}}),ip=$.parseJSON(loc.responseText).ip,version=$.parseJSON(loc.responseText).version,city=$.parseJSON(loc.responseText).city,country=$.parseJSON(loc.responseText).country_name</script><script data-pjax src="https://jerrrywang.github.io/api/npm/hexo-electric-clock-plus/clock.js"></script></body></html>